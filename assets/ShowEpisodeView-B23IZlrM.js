import{c as r,o as n,d as s,_ as J,a as ne,r as v,v as ue,h as S,I as $,b as de,x as ce,w as pe,n as y,t as m,f as b,e as x,p as G,l as N,k as ve,F as A,g as B,G as w,i as me,P as Q,s as fe,j as ge,A as he,D as P,u as _e,y as ye,m as K}from"./index-DrzRNOaN.js";import{S as Y}from"./sweetalert2.esm.all-NNS-RXd7.js";import{r as be}from"./ShoppingCartIcon-BeUZAGEl.js";function xe(j,f){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}const we={},ke={viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",fill:"none"};function $e(j,f){return n(),r("svg",ke,[...f[0]||(f[0]=[ne('<g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path stroke="#e0bc0b" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M27 7H5a2 2 0 00-2 2v14a2 2 0 002 2h22a2 2 0 002-2V9a2 2 0 00-2-2z"></path> <path stroke="#e0bc0b" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 13l3 6.5 3-6.5M16.5 13v6.5M20.5 17.275h1.48c.651 0 1.277-.275 1.721-.75a2.338 2.338 0 00.215-2.932 1.394 1.394 0 00-1.14-.593H20.5v4.275zm0 0V19.5"></path></g>',3)])])}const Te=J(we,[["render",$e]]),Ee={class:"min-h-screen bg-gray-50"},Le={class:"bg-white shadow-sm border-b border-gray-200"},Se={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},Ae={key:1,class:"sr-only"},Be={"aria-label":"Breadcrumb",class:"breadcrumbs text-primary text-sm mt-4",dir:"rtl"},Pe={itemscope:"",itemtype:"https://schema.org/BreadcrumbList"},Ce={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},Ie=["href"],De={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem","aria-current":"page",class:"text-gray-700"},Me={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",role:"main"},Ve={class:"lg:flex lg:gap-8"},Oe={class:"lg:w-7/10"},Ne={class:"relative aspect-video"},je=["poster"],Re={class:"hidden ms:block"},Ue={class:"flex gap-2 md:gap-4 flex flex-col md:flex-row items-center"},ze={key:0,class:"pb-1 px-2"},Fe=["value"],He={class:"bg-white rounded-lg shadow-md p-6 mb-6 mt-6","aria-labelledby":"episode-title"},Ge={key:0,class:"prose xl:prose-lg 2xl:prose-xl text-justify max-w-none"},Qe=["innerHTML"],Ke={key:1,class:"flex flex-col gap-10"},Ye={class:"skeleton h-4 w-full"},Je={key:0,class:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white"},We={class:"text-xl mb-2"},Ze={class:"mb-4 opacity-90"},qe={class:"lg:w-3/10 mb-8 lg:mb-0","aria-label":"فهرست اپیزودها"},Xe={class:"bg-white rounded-lg shadow-md p-4"},et={class:"space-y-2"},tt={class:"font-medium text-gray-900"},ot={class:"skeleton p-8 w-full"},st={__name:"ShowEpisodeView",setup(j){const f=me(),C=ge(),R=v(!0),d=v(null),t=v(null),h=v(null),I=v([]),W=v(null);v("");const T=v(!1),Z=v({}),u=v(null),D=v([]),U=v(-1);ue([]);const q=o=>{if(!t.value)return"";let e=`${w()}site/active-user/get-course-video-file/${t.value.product_id}/${t.value.id}`,i=`${e}/${t.value.video_type}/${o}`;return $()==!1&&(e=`${w()}site/get-course-video-file/${t.value.product_id}/${t.value.id}`,i=`${e}/${t.value.video_type}/${o}`),i},M=()=>t.value?`${`${w()}site/get-file/${f.params.course_link}/episode/${f.params.episode_link}`}/${t.value.video_poster}`:"",z=o=>{if(!o||isNaN(Number(o))||Number(o)<=0)return;let e=Math.floor(Number(o));const i=Math.floor(e/3600);e-=i*3600;const l=Math.floor(e/60);e-=l*60;let a="PT";return i>0&&(a+=`${i}H`),l>0&&(a+=`${l}M`),(e>0||a==="PT")&&(a+=`${e}S`),a};function E(o){let e=o.replace(/<\/(p|h[1-6]|div|ul|ol|li)>/gi,`

`);return e=e.replace(/<li[^>]*>/gi,`
* `),e=e.replace(/<[^>]*>/g,""),e=e.replace(/\t/g,""),e=e.replace(/&nbsp;/g," "),e=e.replace(/\n\n+/g,`

`),e=e.trim(),e}const X=()=>{if(!t.value||!d.value)return;const o=document.querySelector('script[type="application/ld+json"]');o&&o.remove();const e="https://nitrocode.ir/courses/",i=t.value.meta_canonical||`${e}${d.value.link}/${t.value.link}`,l=ie?.value||null,a=M()?encodeURI(M()):void 0,c=[{property:"og:title",content:t.value.meta_title||t.value.title},{property:"og:description",content:t.value.meta_description},{property:"og:image",content:a||""},{name:"description",content:t.value.meta_description},{name:"keywords",content:t.value.meta_keywords||""}];l&&(c.push({property:"og:video",content:l}),c.push({property:"og:video:type",content:"application/dash+xml"})),c.push({name:"robots",content:t?.value?.meta_robots}),c.push({name:"twitter:card",content:"summary_large_image"}),c.push({name:"twitter:title",content:t.value.meta_title||t.value.title}),c.push({name:"twitter:description",content:t.value.meta_description||t.value.description||""}),c.push({name:"twitter:image",content:a||""});const g={"@context":"https://schema.org","@graph":[]},L={"@type":"Course",name:d.value.title,description:E(d.value.description),url:`${e}${d.value.link}`,provider:{"@type":"Organization",name:"NitroCode",url:"https://nitrocode.ir"}};g["@graph"].push(L);const k={"@type":"Organization",name:"NitroCode"};if(H?.value===!0){const p={"@type":"VideoObject",name:t.value.title,description:E(t.value.description),thumbnailUrl:a,isAccessibleForFree:!1,requiresSubscription:!0,inLanguage:"fa",mainEntityOfPage:i,publisher:k,isPartOf:{"@type":"Course",name:d.value.title,url:`${e}${d.value.link}`}};if(l){const _={"@type":"Clip",name:`${t.value.title} — پیش‌نمایش`,description:E(t.value.description),startOffset:0,endOffset:t.value?.free_demo_time,isAccessibleForFree:!0,url:i,inLanguage:"fa",contentUrl:l};p.hasPart=_}p.duration=z(t.value?.duration),p.uploadDate=P(t.value.created_at),p.dateModified=P(t.value.updated_at),Object.keys(p).forEach(_=>p[_]===void 0&&delete p[_]),g["@graph"].push(p)}else{const p={"@type":"VideoObject",name:t.value.title,description:E(t.value.description),thumbnailUrl:a,contentUrl:l||void 0,isAccessibleForFree:!0,inLanguage:"fa",mainEntityOfPage:i,publisher:k,isPartOf:{"@type":"Course",name:d.value.title,url:`${e}${d.value.link}`}};p.duration=z(t.value?.duration),p.uploadDate=P(t.value.created_at),p.dateModified=P(t.value.updated_at),Object.keys(p).forEach(_=>p[_]===void 0&&delete p[_]),g["@graph"].push(p)}const re={"@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"صفحه اصلی",item:"https://nitrocode.ir/"},{"@type":"ListItem",position:2,name:"دوره‌ها",item:e},{"@type":"ListItem",position:3,name:d.value.title||"",item:`${e}${d.value.link}`},{"@type":"ListItem",position:4,name:t.value.title||"",item:i}]};g["@graph"].push(re),_e({title:t.value.meta_title||t.value.title,meta:c,link:[{rel:"canonical",href:i}].concat(h.value?[{rel:"next",href:`${e}${d.value.link}/${h.value.link}`}]:[]),script:[{type:"application/ld+json",children:JSON.stringify(g)}]})},F=async()=>{try{R.value=!0;const{course_link:o,episode_link:e}=f.params;let i=null;$()?i=await Q(`site/active-user/course/${o}/episode/${e}`):i=await Q(`site/course/${o}/episode/${e}`),i.ok&&(d.value=i.product,t.value=i.episode,h.value=i.next_episode,I.value=i.episode_list,Z.value=i.author||{},fe(()=>{X(),ee(),setTimeout(()=>{window.isLoading.value=!1},100)}))}catch(o){console.error("Error fetching episode data:",o)}finally{R.value=!1}},ee=async()=>{try{const{MediaPlayer:o}=await ye(async()=>{const{MediaPlayer:c}=await import("./dash.all.min-D3TBEzDq.js");return{MediaPlayer:c}},[]);u.value&&(u.value.destroy(),u.value=null);let e=t.value.video_target,i=`${w()}site/active-user/get-course-video-file/${t.value.product_id}/${t.value.id}`,l=`${i}/${t.value.video_type}/${e}`;$()==!1&&(i=`${w()}site/get-course-video-file/${t.value.product_id}/${t.value.id}`,l=`${i}/${t.value.video_type}/${e}`),(V.value||O.value)&&(e=t.value.video_preview_target||"preview.mpd",i=`${w()}site/get-course-video-file/${t.value.product_id}/${t.value.id}`,l=`${i}/${t.value.video_type}/${e}`),u.value=o().create(),u.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{audio:!0,video:!0}}}}),u.value.initialize(document.querySelector("#videoPlayer"),l,!1),u.value.on(o.events.QUALITY_CHANGE_REQUESTED,c=>{}),u.value.on(o.events.PLAYBACK_METADATA_LOADED,c=>{D.value=te(u.value)}),u.value.on(o.events.QUALITY_CHANGE_RENDERED,c=>{});let a=!1;u.value.on(o.events.PLAYBACK_TIME_UPDATED,c=>{const g=document.querySelector("#videoPlayer");if(g&&!a){const L=g.currentTime,k=g.duration;k-L<=5&&k>0&&L>0&&(a=!0,T.value=!0)}}),u.value.on(o.events.PLAYBACK_STARTED,c=>{a=!1}),u.value.on(o.events.PLAYBACK_ENDED,c=>{a=!1,T.value=!0})}catch(o){console.error(o)}},te=o=>{if(!o)return[];try{return(o.getRepresentationsByType("video")||[]).map((i,l)=>({index:l,bitrate:i.bitrate,bitrateInKbit:i.bitrateInKbit,width:i.width,height:i.height,id:i.id,label:`${i.height}p`}))}catch(e){return console.error("خطا در دریافت لیست کیفیت‌ها:",e),[]}},oe=o=>{if(!u.value)return;const e=o.target.value;e===""?(u.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!0}}}}),U.value=-1):(u.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!1}}}}),se(u.value,e)&&(U.value=e))},se=(o,e)=>{if(!o)return!1;try{const i=o.getRepresentationsByType("video")||[],l=i.find(a=>a.id==e);return l?(o.setRepresentationForTypeById("video",l.id,!0),!0):(console.warn("Representation موردنظر پیدا نشد:",e,i),!1)}catch(i){return console.error("خطا در تغییر کیفیت:",i),!1}},V=S(()=>t.value?["free_with_login","vip_preview","vip"].indexOf(t.value.display_status)>-1&&$()==!1:!1),O=S(()=>t.value?!!((t.value.display_status=="vip_preview"||t.value.display_status=="vip")&&$()&&t?.value?.user_has_access==!1):!1),H=S(()=>V.value||O.value),ie=S(()=>{if(!t.value)return"";let o=t.value.video_target;return H.value&&(o=t.value.video_preview_target||"preview.mpd"),q(o)});F(),de(()=>{window.scrollTo(0,0)}),ce(()=>{u.value&&(u.value.destroy(),u.value=null)}),pe(()=>f.params.episode_link,(o,e)=>{o&&o!==e&&(F(),window.scrollTo(0,0))});const le=()=>{window.localStorage.setItem("redirect_after_login",f.fullPath),C.push({name:"login"})},ae=async()=>{try{const o=await he("site/active-user/course-shopping/add-to-cart/"+d.value.id);(o.ok||o.ok==!1&&o.carts&&o.carts.length)&&Y.fire({icon:"success",title:"دوره به سبد خرید اضافه شد",text:"می‌توانید پرداخت را انجام دهید یا سبد خرید را مشاهده کنید.",showCancelButton:!0,confirmButtonText:"پرداخت و مشاهده‌ی دوره",cancelButtonText:"مشاهده سبد خرید"}).then(e=>{e.isConfirmed?C.push({name:"user_cart",hash:"#checkout_now"}):e.dismiss===Y.DismissReason.cancel&&C.push({name:"user_cart"})})}catch(o){console.error(o)}};return(o,e)=>{const i=ve("router-link");return n(),r("div",Ee,[s("header",Le,[s("div",Se,[t.value?(n(),r("h1",{key:0,class:y(["text-xl md:text-2xl font-bold text-gray-900",{"skeleton w-56 p-4":!t.value?.title}])},m(t.value?.title||""),3)):(n(),r("h1",Ae,"در حال بارگذاری اپیزود...")),s("nav",Be,[s("ul",Pe,[e[4]||(e[4]=s("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[s("a",{itemprop:"item",href:"/"},[s("span",{itemprop:"name"},"صفحه اصلی")]),s("meta",{itemprop:"position",content:"1"})],-1)),e[5]||(e[5]=s("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[s("a",{itemprop:"item",href:"/courses"},[s("span",{itemprop:"name"},"دوره‌ها")]),s("meta",{itemprop:"position",content:"2"})],-1)),s("li",Ce,[s("a",{itemprop:"item",href:`/courses/${d.value?.link||""}`},[s("span",{itemprop:"name",class:y({"skeleton w-56 p-3":!t.value?.title})},m(d.value?.title||""),3)],8,Ie),e[2]||(e[2]=s("meta",{itemprop:"position",content:"3"},null,-1))]),s("li",De,[s("span",{itemprop:"name",class:y({"skeleton w-56 p-3":!t.value?.title})},m(t.value?.title||""),3),e[3]||(e[3]=s("meta",{itemprop:"position",content:"4"},null,-1))])])])])]),s("main",Me,[s("div",Ve,[s("div",Oe,[s("article",{class:y(["rounded-lg shadow-md overflow-hidden shadow-lg",{skeleton:!t.value?.title}]),"aria-labelledby":"episode-title"},[s("div",Ne,[t.value?(n(),r("video",{key:0,id:"videoPlayer",ref_key:"videoPlayer",ref:W,class:"w-full h-full",controls:"",poster:M(),preload:"metadata",playsinline:""}," مرورگر شما از پخش ویدیو پشتیبانی نمی‌کند لطفا از آخرین نسخه از مرورگر گوگل کروم استفاده کنید ",8,je)):b("",!0),V.value?(n(),r("div",{key:1,class:y(["pulse-opacity-smooth top-0 left-0 w-full gap-2 flex justify-center lg:justify-between p-4 absolute z-10 items-center duration-500 h-20",{"h-full":T.value}])},[e[7]||(e[7]=s("div",{class:"flex-1"},[s("div",{class:"text-sm sm:text-md md:text-lg lg:text-xl font-bold p-2 text-teal-300"}," برای مشاهده‌ی کامل این ویدیو لطفا وارد سایت (حساب کاربری) شوید "),s("p")],-1)),s("div",null,[s("button",{onClick:e[0]||(e[0]=l=>le()),class:"btn btn-sm md:btn-md btn-primary"},[e[6]||(e[6]=s("div",null,"ورود و مشاهده",-1)),s("div",null,[x(G(xe),{class:"size-5 animate-pulse text-green-300"})])])])],2)):b("",!0),O.value?(n(),r("div",{key:2,class:y(["pulse-opacity-smooth top-0 left-0 w-full gap-1 md:gap-2 lg:gap-8 flex flex-col justify-center p-2 ms:p-4 absolute z-10 items-center duration-500",{"h-full":T.value}])},[s("div",Re,[x(Te,{class:"size-8 md:size-12 fill-yello-700 text-yellow-700"})]),e[10]||(e[10]=s("div",{class:"text-md sm:text-lg md:text-xl lg:text-2xl font-bold text-center p-2 text-white"}," بعد از خرید این دوره تمام قسمت‌های آن قابل مشاهده است ",-1)),s("div",Ue,[s("button",{onClick:e[1]||(e[1]=l=>ae()),class:"text-sm md:text-md lg:text-lg hover:bg-black duration-200 cursor-pointer flex items-center gap-2 p-2 border-2 border-[#e0bc0b] text-[#e0bc0b] font-bold rounded-lg items-center"},[e[8]||(e[8]=s("div",null,"خرید این دوره و مشاهده",-1)),s("div",null,[x(G(be),{class:"size-6 animate-pulse text-green-[#e0bc0b]"})])]),x(i,{to:"/courses/"+d.value?.link,class:"text-sm md:text-md lg:text-lg opacity-80 hover:bg-black duration-200 cursor-pointer flex items-center gap-2 p-2 border-2 border-gray-300 text-gray-300 font-bold rounded-lg items-center"},{default:N(()=>[...e[9]||(e[9]=[K(" مشاهده‌ي اطلاعات دوره ",-1)])]),_:1},8,["to"])])],2)):b("",!0)]),D.value.length>1?(n(),r("div",ze,[s("select",{class:"select select-ghost select-sm",onChange:oe},[e[11]||(e[11]=s("option",{value:""},"انتخاب کیفیت : اتوماتیک",-1)),(n(!0),r(A,null,B(D.value,(l,a)=>(n(),r("option",{key:a,value:l.id},m(l.label)+" "+m(l.label=="1080p"?" (کیفیت عالی)":"")+" "+m(l.label=="720p"?" (کیفیت خوب)":"")+" "+m(l.label=="480p"?" (کیفیت کم)":""),9,Fe))),128))],32)])):b("",!0)],2),s("section",He,[e[12]||(e[12]=s("h2",{id:"episode-title",class:"sr-only"},"اطلاعات اپیزود",-1)),t.value?.description?(n(),r("div",Ge,[t.value?.description?(n(),r("p",{key:0,class:"text-gray-800",innerHTML:t.value?.description},null,8,Qe)):b("",!0)])):(n(),r("div",Ke,[(n(!0),r(A,null,B(Array.from({length:10},(l,a)=>a),l=>(n(),r("div",Ye))),256))]))]),h.value?(n(),r("div",Je,[e[14]||(e[14]=s("h3",{class:"text-lg font-bold mb-2"},"قسمت بعدی",-1)),s("h4",We,m(h.value.title),1),s("p",Ze,m(h.value.small_description),1),x(i,{to:{name:"show_episode",params:{course_link:o.course_link,episode_link:h.value.link}},class:"block bg-white text-blue-600 font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center"},{default:N(()=>[...e[13]||(e[13]=[K(" مشاهده قسمت بعدی ",-1),s("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})],-1)])]),_:1},8,["to"])])):b("",!0)]),s("aside",qe,[s("div",Xe,[e[15]||(e[15]=s("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"لیست اپیزودها",-1)),s("ul",et,[I.value.length?(n(!0),r(A,{key:0},B(I.value,(l,a)=>(n(),r("li",{key:a,class:y(["",l.link===t.value?.link?"bg-blue-50 border-r-4 border-blue-500":"hover:bg-gray-50"])},[x(i,{to:{name:"show_episode",params:{course_link:o.course_link,episode_link:l.link}},class:"p-3 rounded-lg cursor-pointer transition-colors block"},{default:N(()=>[s("h3",tt,m(l.title),1)]),_:2},1032,["to"])],2))),128)):(n(!0),r(A,{key:1},B(Array.from({length:10},(l,a)=>a+1),l=>(n(),r("li",ot))),256))])])])])])])}}},rt=J(st,[["__scopeId","data-v-c3ae2c81"]]);export{rt as default};
