import{_ as f,r as u,b as h,j as v,P as S,c as l,o as c,f as i,t as k,i as I}from"./index-DpGbfG3F.js";const b={class:"callback-container"},y={key:0},w={key:1,class:"error"},P={__name:"AuthGoogleCallback",setup(x){const r=v();I();const t=u(!0),e=u(null);return h(async()=>{const o=new URLSearchParams(window.location.search),a=o.get("code"),n=o.get("state"),_=sessionStorage.getItem("google_auth_state");if(!n||n!==_){e.value="خطای امنیتی: State معتبر نیست.",t.value=!1,setTimeout(()=>r.push("/login?error=csrf"),2e3);return}if(sessionStorage.removeItem("google_auth_state"),console.log("get code",a),a)try{const{client_api_token:s,picture:g,first_name:m,last_name:d,email:p}=await S("site/auth/get-google-access-token",{code:a});localStorage.setItem("client_api_token",s),localStorage.setItem("picture",g),localStorage.setItem("first_name",m),localStorage.setItem("last_name",d),localStorage.setItem("email",p),r.replace({name:"login_success_message"})}catch(s){console.error("Login failed:",s),e.value="ورود با گوگل موفقیت‌آمیز نبود. لطفاً دوباره تلاش کنید.",t.value=!1}else e.value="شما اجازه دسترسی را ندادید.",t.value=!1}),(o,a)=>(c(),l("div",b,[t.value?(c(),l("p",y,"لطفا صبر کنید ...")):i("",!0),e.value?(c(),l("p",w,k(e.value),1)):i("",!0)]))}},R=f(P,[["__scopeId","data-v-b5352a74"]]);export{R as default};
