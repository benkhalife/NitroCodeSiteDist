import{c as a,o as n,d as t,_ as U,a as J,r as d,v as X,h as j,I as B,b as q,x as ee,w as te,n as v,t as c,f as _,e as f,p as z,l as L,k as oe,F as x,g as y,i as se,P as N,u as le,s as ie,G as C,j as re,A as ae,y as ne,m as H}from"./index-CTFrbp2D.js";import{S as Q}from"./sweetalert2.esm.all-NNS-RXd7.js";import{r as ue}from"./ShoppingCartIcon-DWIO_N7a.js";function de(P,p){return n(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}const ce={},pe={viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",fill:"none"};function me(P,p){return n(),a("svg",pe,[...p[0]||(p[0]=[J('<g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path stroke="#e0bc0b" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M27 7H5a2 2 0 00-2 2v14a2 2 0 002 2h22a2 2 0 002-2V9a2 2 0 00-2-2z"></path> <path stroke="#e0bc0b" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 13l3 6.5 3-6.5M16.5 13v6.5M20.5 17.275h1.48c.651 0 1.277-.275 1.721-.75a2.338 2.338 0 00.215-2.932 1.394 1.394 0 00-1.14-.593H20.5v4.275zm0 0V19.5"></path></g>',3)])])}const ve=U(ce,[["render",me]]),ge={class:"min-h-screen bg-gray-50"},_e={class:"bg-white shadow-sm border-b border-gray-200"},fe={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},he={"aria-label":"Breadcrumb",class:"breadcrumbs text-primary text-sm mt-4",dir:"rtl"},be={itemscope:"",itemtype:"https://schema.org/BreadcrumbList"},xe={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},ye=["href"],we={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem","aria-current":"page",class:"text-gray-700"},ke={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Ae={class:"lg:flex lg:gap-8"},Te={class:"lg:w-7/10"},$e={class:"relative aspect-video"},Ee=["poster"],Be={class:"hidden ms:block"},Le={class:"flex gap-2 md:gap-4 flex flex-col md:flex-row items-center"},Ce={key:0,class:"pb-1 px-2"},Pe=["value"],Se={class:"bg-white rounded-lg shadow-md p-6 mb-6 mt-6"},Ve={key:0,class:"prose xl:prose-lg 2xl:prose-xl text-justify max-w-none"},Ie=["innerHTML"],Re={key:1,class:"flex flex-col gap-10"},De={class:"skeleton h-4 w-full"},Me={key:0,class:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white"},je={class:"text-xl mb-2"},ze={class:"mb-4 opacity-90"},Ne={class:"lg:w-3/10 mb-8 lg:mb-0"},He={class:"bg-white rounded-lg shadow-md p-4"},Qe={class:"space-y-2"},Ue={class:"font-medium text-gray-900"},Ge={class:"skeleton p-8 w-full"},Ye={__name:"ShowEpisodeView",setup(P){const p=se(),w=re(),S=d(!0),g=d(null),s=d(null),h=d(null),k=d([]),G=d(null);d("");const b=d(!1),r=d(null),A=d([]),V=d(-1);X([]);const I=async()=>{try{S.value=!0;const{course_link:o,episode_link:e}=p.params;let l=null;B?l=await N(`site/active-user/course/${o}/episode/${e}`):l=await N(`site/course/${o}/episode/${e}`),l.ok&&(g.value=l.product,s.value=l.episode,h.value=l.next_episode,k.value=l.episode_list,le({title:s.value.meta_title,meta:[{property:"og:title",content:s.value.meta_title},{property:"og:description",content:s.value.meta_description},{property:"og:image",content:R()},{name:"description",content:s.value.meta_description},{name:"keywords",content:s.value.meta_keywords}],link:[{rel:"canonical",href:s.value.meta_canonical||`https://nitrocode.ir/course/${g.value.link}/${s.value.link}`}]}),ie(()=>{Y(),setTimeout(()=>{window.isLoading.value=!1},100)}))}catch(o){console.error("Error fetching episode data:",o)}finally{S.value=!1}},R=()=>`${`${C()}site/get-file/${p.params.course_link}/episode/${p.params.episode_link}`}/${s.value.video_poster}`,Y=async()=>{try{const{MediaPlayer:o}=await ne(async()=>{const{MediaPlayer:m}=await import("./dash.all.min-D3TBEzDq.js");return{MediaPlayer:m}},[]);r.value&&(r.value.destroy(),r.value=null,console.log("destroy old player"));let e=s.value.video_target,l=`${C()}site/active-user/get-course-video-file/${s.value.product_id}/${s.value.id}`,i=`${l}/${s.value.video_type}/${e}`;console.log("justWithLogin.value || justWithLoginAndVIP.value",T.value,$.value),(T.value||$.value)&&(e="preview.mpd?v=2",l=`${C()}site/get-course-video-file/${s.value.product_id}/${s.value.id}`,i=`${l}/${s.value.video_type}/${e}?v=8`),r.value=o().create(),r.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{audio:!0,video:!0}}}}),r.value.initialize(document.querySelector("#videoPlayer"),i,!1),r.value.on(o.events.QUALITY_CHANGE_REQUESTED,m=>{console.log("تغییر کیفیت درخواست شد:",m)}),r.value.on(o.events.PLAYBACK_METADATA_LOADED,m=>{console.log("Load Video METADATA"),A.value=K(r.value)}),r.value.on(o.events.QUALITY_CHANGE_RENDERED,m=>{console.info("QUALITY :",m?.newRepresentation?.height)});let u=!1;r.value.on(o.events.PLAYBACK_TIME_UPDATED,m=>{const E=document.querySelector("#videoPlayer");if(E&&!u){const D=E.currentTime,M=E.duration;M-D<=5&&M>0&&D>0&&(u=!0,console.log("Video is about to end (within 2 seconds)"),b.value=!0)}}),r.value.on(o.events.PLAYBACK_STARTED,m=>{u=!1}),r.value.on(o.events.PLAYBACK_ENDED,m=>{console.log("Video ended completely"),u=!1,b.value=!0})}catch(o){console.error(o)}},K=o=>{if(!o)return console.log("player not init in getAvailableBitrates",o),[];try{return(o.getRepresentationsByType("video")||[]).map((l,i)=>({index:i,bitrate:l.bitrate,bitrateInKbit:l.bitrateInKbit,width:l.width,height:l.height,id:l.id,label:`${l.height}p`}))}catch(e){return console.error("خطا در دریافت لیست کیفیت‌ها:",e),[]}},F=o=>{if(!r.value)return;const e=o.target.value;e===""?(console.log("Set Auto (ABR)"),r.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!0}}}}),V.value=-1):(console.log("Change by user:",e),r.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!1}}}}),O(r.value,e)&&(V.value=e))},O=(o,e)=>{if(!o)return!1;try{const l=o.getRepresentationsByType("video")||[],i=l.find(u=>u.id==e);return i?(o.setRepresentationForTypeById("video",i.id,!0),console.log("کیفیت دستی تنظیم شد روی:",i),!0):(console.warn("Representation موردنظر پیدا نشد:",e,l),!1)}catch(l){return console.error("خطا در تغییر کیفیت:",l),!1}},T=j(()=>s.value?["free_with_login","vip_preview","vip"].indexOf(s.value.display_status)>-1&&B()==!1:!1),$=j(()=>s.value?!!((s.value.display_status=="vip_preview"||s.value.display_status=="vip")&&B()&&s?.value?.user_has_access==!1):!1);I(),q(()=>{window.scrollTo(0,0)}),ee(()=>{r.value&&(r.value.destroy(),r.value=null)}),te(()=>p.params.episode_link,(o,e)=>{o&&o!==e&&(I(),window.scrollTo(0,0))});const W=()=>{window.localStorage.setItem("redirect_after_login",p.fullPath),w.push({name:"login"})},Z=async()=>{try{const o=await ae("site/active-user/course-shopping/add-to-cart/"+g.value.id);(o.ok||o.ok==!1&&o.carts&&o.carts.length)&&Q.fire({icon:"success",title:"دوره به سبد خرید اضافه شد",text:"می‌توانید پرداخت را انجام دهید یا سبد خرید را مشاهده کنید.",showCancelButton:!0,confirmButtonText:"پرداخت و مشاهده‌ی دوره",cancelButtonText:"مشاهده سبد خرید"}).then(e=>{e.isConfirmed?w.push({name:"user_cart",hash:"#checkout_now"}):e.dismiss===Q.DismissReason.cancel&&w.push({name:"user_cart"})})}catch(o){console.error(o)}};return(o,e)=>{const l=oe("router-link");return n(),a("div",ge,[t("header",_e,[t("div",fe,[t("h1",{class:v(["text-xl md:text-2xl font-bold text-gray-900",{"skeleton w-56 p-4":!s.value?.title}])},c(s.value?.title||""),3),t("nav",he,[t("ul",be,[e[4]||(e[4]=t("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[t("a",{itemprop:"item",href:"/"},[t("span",{itemprop:"name"},"صفحه اصلی")]),t("meta",{itemprop:"position",content:"1"})],-1)),e[5]||(e[5]=t("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[t("a",{itemprop:"item",href:"/courses"},[t("span",{itemprop:"name"},"دوره‌ها")]),t("meta",{itemprop:"position",content:"2"})],-1)),t("li",xe,[t("a",{itemprop:"item",href:`/courses/${g.value?.link||""}`},[t("span",{itemprop:"name",class:v({"skeleton w-56 p-3":!s.value?.title})},c(g.value?.title||""),3)],8,ye),e[2]||(e[2]=t("meta",{itemprop:"position",content:"3"},null,-1))]),t("li",we,[t("span",{itemprop:"name",class:v({"skeleton w-56 p-3":!s.value?.title})},c(s.value?.title||""),3),e[3]||(e[3]=t("meta",{itemprop:"position",content:"4"},null,-1))])])])])]),t("main",ke,[t("div",Ae,[t("div",Te,[t("div",{class:v(["rounded-lg shadow-md overflow-hidden shadow-lg",{skeleton:!s.value?.title}])},[t("div",$e,[s.value?(n(),a("video",{key:0,id:"videoPlayer",ref_key:"videoPlayer",ref:G,class:"w-full h-full",controls:"",poster:R()}," مرورگر شما از پخش ویدیو پشتیبانی نمی‌کند لطفا از آخرین نسخه از مرورگر گوگل کروم استفاده کنید ",8,Ee)):_("",!0),T.value?(n(),a("div",{key:1,class:v(["pulse-opacity-smooth top-0 left-0 w-full gap-2 flex justify-center lg:justify-between p-4 absolute z-10 items-center duration-500 h-20",{"h-full":b.value}])},[e[7]||(e[7]=t("div",{class:"flex-1"},[t("div",{class:"text-sm sm:text-md md:text-lg lg:text-xl font-bold p-2 text-teal-300"}," برای مشاهده‌ی کامل این ویدیو لطفا وارد سایت (حساب کاربری) شوید "),t("p")],-1)),t("div",null,[t("button",{onClick:e[0]||(e[0]=i=>W()),class:"btn btn-sm md:btn-md btn-primary"},[e[6]||(e[6]=t("div",null,"ورود و مشاهده",-1)),t("div",null,[f(z(de),{class:"size-5 animate-pulse text-green-300"})])])])],2)):_("",!0),$.value?(n(),a("div",{key:2,class:v(["pulse-opacity-smooth top-0 left-0 w-full gap-1 md:gap-2 lg:gap-8 flex flex-col justify-center p-2 ms:p-4 absolute z-10 items-center duration-500",{"h-full":b.value}])},[t("div",Be,[f(ve,{class:"size-8 md:size-12 fill-yello-700 text-yellow-700"})]),e[10]||(e[10]=t("div",{class:"text-md sm:text-lg md:text-xl lg:text-2xl font-bold text-center p-2 text-white"}," بعد از خرید این دوره تمام قسمت‌های آن قابل مشاهده است ",-1)),t("div",Le,[t("button",{onClick:e[1]||(e[1]=i=>Z()),class:"text-sm md:text-md lg:text-lg hover:bg-black duration-200 cursor-pointer flex items-center gap-2 p-2 border-2 border-[#e0bc0b] text-[#e0bc0b] font-bold rounded-lg items-center"},[e[8]||(e[8]=t("div",null,"خرید این دوره و مشاهده",-1)),t("div",null,[f(z(ue),{class:"size-6 animate-pulse text-green-[#e0bc0b]"})])]),f(l,{to:"/courses/"+g.value?.link,class:"text-sm md:text-md lg:text-lg opacity-80 hover:bg-black duration-200 cursor-pointer flex items-center gap-2 p-2 border-2 border-gray-300 text-gray-300 font-bold rounded-lg items-center"},{default:L(()=>[...e[9]||(e[9]=[H(" مشاهده‌ي اطلاعات دوره ",-1)])]),_:1},8,["to"])])],2)):_("",!0)]),A.value.length>1?(n(),a("div",Ce,[t("select",{class:"select select-ghost select-sm",onChange:F},[e[11]||(e[11]=t("option",{value:""},"انتخاب کیفیت : اتوماتیک",-1)),(n(!0),a(x,null,y(A.value,(i,u)=>(n(),a("option",{key:u,value:i.id},c(i.label)+" "+c(i.label=="1080p"?" (کیفیت عالی)":"")+" "+c(i.label=="720p"?" (کیفیت خوب)":"")+" "+c(i.label=="480p"?" (کیفیت کم)":""),9,Pe))),128))],32)])):_("",!0)],2),t("div",Se,[s.value?.description?(n(),a("div",Ve,[s.value?.description?(n(),a("p",{key:0,class:"text-gray-800",innerHTML:s.value?.description},null,8,Ie)):_("",!0)])):(n(),a("div",Re,[(n(!0),a(x,null,y(Array.from({length:10},(i,u)=>u),i=>(n(),a("div",De))),256))]))]),h.value?(n(),a("div",Me,[e[13]||(e[13]=t("h3",{class:"text-lg font-bold mb-2"},"قسمت بعدی",-1)),t("h4",je,c(h.value.title),1),t("p",ze,c(h.value.small_description),1),f(l,{to:{name:"show_episode",params:{course_link:o.course_link,episode_link:h.value.link}},class:"block bg-white text-blue-600 font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center"},{default:L(()=>[...e[12]||(e[12]=[H(" مشاهده قسمت بعدی ",-1),t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})],-1)])]),_:1},8,["to"])])):_("",!0)]),t("aside",Ne,[t("div",He,[e[14]||(e[14]=t("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"لیست اپیزودها",-1)),t("ul",Qe,[k.value.length?(n(!0),a(x,{key:0},y(k.value,(i,u)=>(n(),a("li",{key:u,class:v(["",i.link===s.value?.link?"bg-blue-50 border-r-4 border-blue-500":"hover:bg-gray-50"])},[f(l,{to:{name:"show_episode",params:{course_link:o.course_link,episode_link:i.link}},class:"p-3 rounded-lg cursor-pointer transition-colors block"},{default:L(()=>[t("h3",Ue,c(i.title),1)]),_:2},1032,["to"])],2))),128)):(n(!0),a(x,{key:1},y(Array.from({length:10},(i,u)=>u+1),i=>(n(),a("li",Ge))),256))])])])])])])}}},We=U(Ye,[["__scopeId","data-v-1253a2f2"]]);export{We as default};
