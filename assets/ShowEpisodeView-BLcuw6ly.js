import{r as u,q as S,b as I,s as C,w as D,c as r,o as n,d as e,n as v,t as c,f as h,F as g,g as y,e as E,l as L,k as M,i as Q,u as V,v as N,x as H,j as U,m as j}from"./index-WxJNGnfi.js";const Y={class:"min-h-screen bg-gray-50"},z={class:"bg-white shadow-sm border-b border-gray-200"},F={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},K={"aria-label":"Breadcrumb",class:"breadcrumbs text-primary text-sm mt-4",dir:"rtl"},O={itemscope:"",itemtype:"https://schema.org/BreadcrumbList"},G={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},J=["href"],W={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem","aria-current":"page",class:"text-gray-700"},X={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},Z={class:"lg:flex lg:gap-8"},q={class:"lg:w-7/10"},ee={class:"relative aspect-video"},te=["poster"],oe={key:0,class:"pb-1 px-2"},se=["value"],le={class:"bg-white rounded-lg shadow-md p-6 mb-6 mt-6"},ie={key:0,class:"prose xl:prose-lg 2xl:prose-xl text-justify max-w-none"},ae=["innerHTML"],re={key:1,class:"flex flex-col gap-10"},ne={class:"skeleton h-4 w-full"},ue={key:0,class:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white"},ce={class:"text-xl mb-2"},de={class:"mb-4 opacity-90"},pe={class:"lg:w-3/10 mb-8 lg:mb-0"},me={class:"bg-white rounded-lg shadow-md p-4"},ve={class:"space-y-2"},_e={class:"font-medium text-gray-900"},he={class:"skeleton p-8 w-full"},be={__name:"ShowEpisodeView",setup(ge){const p=Q();U();const k=u(!0),_=u(null),i=u(null),m=u(null),b=u([]),T=u(null);u("");const a=u(null),f=u([]),w=u(-1);S([]);const x=async()=>{try{k.value=!0;const{course_link:s,episode_link:t}=p.params,l=await fetch(`https://api.nitrocode.ir/site/course/${s}/episode/${t}`,{method:"POST"}).then(o=>o.json());l.ok&&(_.value=l.product,i.value=l.episode,m.value=l.next_episode,b.value=l.episode_list,V({title:i.value.meta_title,meta:[{property:"og:title",content:i.value.meta_title},{property:"og:description",content:i.value.meta_description},{property:"og:image",content:A()},{name:"description",content:i.value.meta_description},{name:"keywords",content:i.value.meta_keywords}],link:[{rel:"canonical",href:i.value.meta_canonical||`https://nitrocode.ir/course/${_.value.link}/${i.value.link}`}]}),N(()=>{B(),setTimeout(()=>{window.isLoading.value=!1},100)}))}catch(s){console.error("Error fetching episode data:",s)}finally{k.value=!1}},A=()=>`${`https://api.nitrocode.ir/site/get-file/${p.params.course_link}/episode/${p.params.episode_link}`}/${i.value.video_poster}`,B=async()=>{try{const{MediaPlayer:s}=await H(async()=>{const{MediaPlayer:o}=await import("./dash.all.min-D3TBEzDq.js");return{MediaPlayer:o}},[]);a.value&&(a.value.destroy(),a.value=null,console.log("destroy old player"));const l=`${`https://api.nitrocode.ir/site/get-file/${p.params.course_link}/episode/${p.params.episode_link}`}/${i.value.video_target}`;a.value=s().create(),a.value.initialize(document.querySelector("#videoPlayer"),l,!1),a.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{audio:!0,video:!0}}}}),a.value.on(s.events.QUALITY_CHANGE_REQUESTED,o=>{console.log("تغییر کیفیت درخواست شد:",o)}),a.value.on(s.events.PLAYBACK_METADATA_LOADED,o=>{console.log("Load Video METADATA"),f.value=$(a.value)}),a.value.on(s.events.QUALITY_CHANGE_RENDERED,o=>{console.info("QUALITY :",o?.newRepresentation?.height)})}catch(s){console.error(s)}},$=s=>{if(!s)return console.log("player not init in getAvailableBitrates",s),[];try{return(s.getRepresentationsByType("video")||[]).map((l,o)=>({index:o,bitrate:l.bitrate,bitrateInKbit:l.bitrateInKbit,width:l.width,height:l.height,id:l.id,label:`${l.height}p`}))}catch(t){return console.error("خطا در دریافت لیست کیفیت‌ها:",t),[]}},P=s=>{if(!a.value)return;const t=s.target.value;t===""?(console.log("Set Auto (ABR)"),a.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!0}}}}),w.value=-1):(console.log("Change by user:",t),a.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!1}}}}),R(a.value,t)&&(w.value=t))},R=(s,t)=>{if(!s)return!1;try{const l=s.getRepresentationsByType("video")||[],o=l.find(d=>d.id==t);return o?(s.setRepresentationForTypeById("video",o.id,!0),console.log("کیفیت دستی تنظیم شد روی:",o),!0):(console.warn("Representation موردنظر پیدا نشد:",t,l),!1)}catch(l){return console.error("خطا در تغییر کیفیت:",l),!1}};return x(),I(()=>{window.scrollTo(0,0)}),C(()=>{a.value&&(a.value.destroy(),a.value=null)}),D(()=>p.params.episode_link,(s,t)=>{s&&s!==t&&(x(),window.scrollTo(0,0))}),(s,t)=>{const l=M("router-link");return n(),r("div",Y,[e("header",z,[e("div",F,[e("h1",{class:v(["text-xl md:text-2xl font-bold text-gray-900",{"skeleton w-56 p-4":!i.value?.title}])},c(i.value?.title||""),3),e("nav",K,[e("ul",O,[t[2]||(t[2]=e("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[e("a",{itemprop:"item",href:"/"},[e("span",{itemprop:"name"},"صفحه اصلی")]),e("meta",{itemprop:"position",content:"1"})],-1)),t[3]||(t[3]=e("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[e("a",{itemprop:"item",href:"/courses"},[e("span",{itemprop:"name"},"دوره‌ها")]),e("meta",{itemprop:"position",content:"2"})],-1)),e("li",G,[e("a",{itemprop:"item",href:`/courses/${_.value?.link||""}`},[e("span",{itemprop:"name",class:v({"skeleton w-56 p-3":!i.value?.title})},c(_.value?.title||""),3)],8,J),t[0]||(t[0]=e("meta",{itemprop:"position",content:"3"},null,-1))]),e("li",W,[e("span",{itemprop:"name",class:v({"skeleton w-56 p-3":!i.value?.title})},c(i.value?.title||""),3),t[1]||(t[1]=e("meta",{itemprop:"position",content:"4"},null,-1))])])])])]),e("main",X,[e("div",Z,[e("div",q,[e("div",{class:v(["rounded-lg shadow-md overflow-hidden shadow-lg",{skeleton:!i.value?.title}])},[e("div",ee,[i.value?(n(),r("video",{key:0,id:"videoPlayer",ref_key:"videoPlayer",ref:T,class:"w-full h-full",controls:"",poster:A()}," مرورگر شما از پخش ویدیو پشتیبانی نمی‌کند لطفا از آخرین نسخه از مرورگر گوگل کروم استفاده کنید ",8,te)):h("",!0)]),f.value.length>1?(n(),r("div",oe,[e("select",{class:"select select-ghost select-sm",onChange:P},[t[4]||(t[4]=e("option",{value:""},"انتخاب کیفیت : اتوماتیک",-1)),(n(!0),r(g,null,y(f.value,(o,d)=>(n(),r("option",{key:d,value:o.id},c(o.label)+" "+c(o.label=="1080p"?" (کیفیت عالی)":"")+" "+c(o.label=="720p"?" (کیفیت خوب)":"")+" "+c(o.label=="480p"?" (کیفیت کم)":""),9,se))),128))],32)])):h("",!0)],2),e("div",le,[i.value?.description?(n(),r("div",ie,[i.value?.description?(n(),r("p",{key:0,class:"text-gray-800",innerHTML:i.value?.description},null,8,ae)):h("",!0)])):(n(),r("div",re,[(n(!0),r(g,null,y(Array.from({length:10},(o,d)=>d),o=>(n(),r("div",ne))),256))]))]),m.value?(n(),r("div",ue,[t[6]||(t[6]=e("h3",{class:"text-lg font-bold mb-2"},"قسمت بعدی",-1)),e("h4",ce,c(m.value.title),1),e("p",de,c(m.value.small_description),1),E(l,{to:{name:"show_episode",params:{course_link:s.course_link,episode_link:m.value.link}},class:"block bg-white text-blue-600 font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center"},{default:L(()=>[...t[5]||(t[5]=[j(" مشاهده قسمت بعدی ",-1),e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})],-1)])]),_:1},8,["to"])])):h("",!0)]),e("aside",pe,[e("div",me,[t[7]||(t[7]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"لیست اپیزودها",-1)),e("ul",ve,[b.value.length?(n(!0),r(g,{key:0},y(b.value,(o,d)=>(n(),r("li",{key:d,class:v(["",o.link===i.value?.link?"bg-blue-50 border-r-4 border-blue-500":"hover:bg-gray-50"])},[E(l,{to:{name:"show_episode",params:{course_link:s.course_link,episode_link:o.link}},class:"p-3 rounded-lg cursor-pointer transition-colors block"},{default:L(()=>[e("h3",_e,c(o.title),1)]),_:2},1032,["to"])],2))),128)):(n(!0),r(g,{key:1},y(Array.from({length:10},(o,d)=>d+1),o=>(n(),r("li",he))),256))])])])])])])}}};export{be as default};
