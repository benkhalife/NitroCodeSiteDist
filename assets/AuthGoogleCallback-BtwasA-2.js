import{_ as h,r as _,b as v,j as S,P as k,c as l,o as c,f as u,t as I,i as w}from"./index-DJmPbI5T.js";const b={class:"callback-container"},y={key:0},P={key:1,class:"error"},x={__name:"AuthGoogleCallback",setup(C){const o=S();w();const t=_(!0),e=_(null);return v(async()=>{const s=new URLSearchParams(window.location.search),a=s.get("code"),n=s.get("state"),g=sessionStorage.getItem("google_auth_state");if(!n||n!==g){e.value="خطای امنیتی: State معتبر نیست.",t.value=!1,setTimeout(()=>o.push("/login?error=csrf"),2e3);return}if(sessionStorage.removeItem("google_auth_state"),console.log("get code",a),a)try{const{client_api_token:r,picture:m,first_name:d,last_name:f,email:p}=await k("site/auth/get-google-access-token",{code:a});localStorage.setItem("client_api_token",r),localStorage.setItem("picture",m),localStorage.setItem("first_name",d),localStorage.setItem("last_name",f),localStorage.setItem("email",p);const i=window.localStorage.getItem("redirect_after_login")||!1;if(i){window.localStorage.removeItem("redirect_after_login"),o.replace({path:i});return}else o.replace({name:"login_success_message"})}catch(r){console.error("Login failed:",r),e.value="ورود با گوگل موفقیت‌آمیز نبود. لطفاً دوباره تلاش کنید.",t.value=!1}else e.value="شما اجازه دسترسی را ندادید.",t.value=!1}),(s,a)=>(c(),l("div",b,[t.value?(c(),l("p",y,"لطفا صبر کنید ...")):u("",!0),e.value?(c(),l("p",P,I(e.value),1)):u("",!0)]))}},A=h(x,[["__scopeId","data-v-7c6b753d"]]);export{A as default};
