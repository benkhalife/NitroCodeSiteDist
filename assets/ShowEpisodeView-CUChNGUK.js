import{r as c,q as R,b as S,s as I,w as C,c as r,o as n,d as e,t as d,f as _,F as g,g as y,e as E,l as A,k as D,i as M,u as Q,v as V,x as N,j as H,m as U,n as j}from"./index-GRHeRKkU.js";const Y={class:"min-h-screen bg-gray-50"},z={class:"bg-white shadow-sm border-b"},F={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},K={class:"text-2xl font-bold text-gray-900"},O={"aria-label":"Breadcrumb",class:"breadcrumbs text-primary text-sm mt-4",dir:"rtl"},G={itemscope:"",itemtype:"https://schema.org/BreadcrumbList"},J={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},W=["href"],X={itemprop:"name"},Z={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem",class:"text-gray-700"},q={itemprop:"name"},ee={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},te={class:"lg:flex lg:gap-8"},oe={class:"lg:w-7/10"},se={class:"bg-black rounded-lg shadow-md overflow-hidden shadow-lg"},ie={class:"relative aspect-video bg-black"},le=["poster"],ae={key:0,class:"pb-1 px-2"},re=["value"],ne={class:"bg-white rounded-lg shadow-md p-6 mb-6 mt-6"},ce={key:0,class:"prose-sm md:prose lg:prose-xl text-justify max-w-none"},de=["innerHTML"],ue={key:1,class:"flex flex-col gap-10"},pe={class:"skeleton h-4 w-full"},me={key:0,class:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white"},ve={class:"text-xl mb-2"},_e={class:"mb-4 opacity-90"},he={class:"lg:w-3/10 mb-8 lg:mb-0"},ge={class:"bg-white rounded-lg shadow-md p-4"},ye={class:"space-y-2"},be={class:"font-medium text-gray-900"},we={__name:"ShowEpisodeView",setup(fe){const p=M();H();const b=c(!0),v=c(null),l=c(null),m=c(null),f=c([]),L=c(null);c("");const a=c(null),h=c([]),k=c(-1);R([{author:"علی رضایی",date:"۲ ساعت پیش",text:"عالی بود! خیلی از توضیحاتتون استفاده کردم. ممنون از دوره خوبتون.",likes:5},{author:"سارا محمدی",date:"۵ ساعت پیش",text:"من تازه شروع به یادگیری جاوا اسکریپت کردم، این دوره خیلی بهم کمک کرد. ممنونم!",likes:3},{author:"محمد احمدی",date:"۱ روز پیش",text:"آیا برای این دوره پیش‌نیازی خاصی لازم است؟",likes:1}]);const w=async()=>{try{b.value=!0;const{course_link:o,episode_link:t}=p.params,i=await fetch(`https://api.nitrocode.ir/site/course/${o}/episode/${t}`,{method:"POST"}).then(s=>s.json());i.ok&&(v.value=i.product,l.value=i.episode,m.value=i.next_episode,f.value=i.episode_list,Q({title:l.value.meta_title,meta:[{property:"og:title",content:l.value.meta_title},{property:"og:description",content:l.value.meta_description},{property:"og:image",content:x()},{name:"description",content:l.value.meta_description},{name:"keywords",content:l.value.meta_keywords}],link:[{rel:"canonical",href:l.value.meta_canonical||`https://nitrocode.ir/course/${v.value.link}/${l.value.link}`}]}),V(()=>{T()}))}catch(o){console.error("Error fetching episode data:",o)}finally{b.value=!1}},x=()=>`${`https://api.nitrocode.ir/site/get-file/${p.params.course_link}/episode/${p.params.episode_link}`}/${l.value.video_poster}`,T=async()=>{try{const{MediaPlayer:o}=await N(async()=>{const{MediaPlayer:s}=await import("./dash.all.min-D3TBEzDq.js");return{MediaPlayer:s}},[]);a.value&&(a.value.destroy(),a.value=null,console.log("destroy old player"));const i=`${`https://api.nitrocode.ir/site/get-file/${p.params.course_link}/episode/${p.params.episode_link}`}/${l.value.video_target}`;a.value=o().create(),a.value.initialize(document.querySelector("#videoPlayer"),i,!1),a.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{audio:!0,video:!0}}}}),a.value.on(o.events.QUALITY_CHANGE_REQUESTED,s=>{console.log("تغییر کیفیت درخواست شد:",s)}),a.value.on(o.events.PLAYBACK_METADATA_LOADED,s=>{console.log("Load Video METADATA"),h.value=B(a.value)}),a.value.on(o.events.QUALITY_CHANGE_RENDERED,s=>{console.info("QUALITY :",s?.newRepresentation?.height)})}catch(o){console.error(o)}},B=o=>{if(!o)return console.log("player not init in getAvailableBitrates",o),[];try{return(o.getRepresentationsByType("video")||[]).map((i,s)=>({index:s,bitrate:i.bitrate,bitrateInKbit:i.bitrateInKbit,width:i.width,height:i.height,id:i.id,label:`${i.height}p`}))}catch(t){return console.error("خطا در دریافت لیست کیفیت‌ها:",t),[]}},$=o=>{if(!a.value)return;const t=o.target.value;t===""?(console.log("Set Auto (ABR)"),a.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!0}}}}),k.value=-1):(console.log("Change by user:",t),a.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!1}}}}),P(a.value,t)&&(k.value=t))},P=(o,t)=>{if(!o)return!1;try{const i=o.getRepresentationsByType("video")||[],s=i.find(u=>u.id==t);return s?(o.setRepresentationForTypeById("video",s.id,!0),console.log("کیفیت دستی تنظیم شد روی:",s),!0):(console.warn("Representation موردنظر پیدا نشد:",t,i),!1)}catch(i){return console.error("خطا در تغییر کیفیت:",i),!1}};return w(),S(()=>{window.scrollTo(0,0)}),I(()=>{a.value&&(a.value.destroy(),a.value=null)}),C(()=>p.params.episode_link,(o,t)=>{o&&o!==t&&(w(),window.scrollTo(0,0))}),(o,t)=>{const i=D("router-link");return n(),r("div",Y,[e("header",z,[e("div",F,[e("h1",K,d(l.value?.title||"در حال بارگذاری..."),1),e("nav",O,[e("ul",G,[t[2]||(t[2]=e("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[e("a",{itemprop:"item",href:"/"},[e("span",{itemprop:"name"},"صفحه اصلی")]),e("meta",{itemprop:"position",content:"1"})],-1)),t[3]||(t[3]=e("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[e("a",{itemprop:"item",href:"/courses"},[e("span",{itemprop:"name"},"دوره‌ها")]),e("meta",{itemprop:"position",content:"2"})],-1)),e("li",J,[e("a",{itemprop:"item",href:`/courses/${v.value?.link||""}`},[e("span",X,d(v.value?.title||""),1)],8,W),t[0]||(t[0]=e("meta",{itemprop:"position",content:"3"},null,-1))]),e("li",Z,[e("span",q,d(l.value?.title||""),1),t[1]||(t[1]=e("meta",{itemprop:"position",content:"4"},null,-1))])])])])]),e("main",ee,[e("div",te,[e("div",oe,[e("div",se,[e("div",ie,[l.value?(n(),r("video",{key:0,id:"videoPlayer",ref_key:"videoPlayer",ref:L,class:"w-full h-full",controls:"",poster:x()}," مرورگر شما از پخش ویدیو پشتیبانی نمی‌کند لطفا از آخرین نسخه از مرورگر گوگل کروم استفاده کنید ",8,le)):_("",!0)]),h.value.length>1?(n(),r("div",ae,[e("select",{class:"select select-ghost select-sm",onChange:$},[t[4]||(t[4]=e("option",{value:""},"انتخاب کیفیت : اتوماتیک",-1)),(n(!0),r(g,null,y(h.value,(s,u)=>(n(),r("option",{key:u,value:s.id},d(s.label)+" "+d(s.label=="1080p"?" (کیفیت عالی)":"")+" "+d(s.label=="720p"?" (کیفیت خوب)":"")+" "+d(s.label=="480p"?" (کیفیت کم)":""),9,re))),128))],32)])):_("",!0)]),e("div",ne,[l.value?.description?(n(),r("div",ce,[l.value?.description?(n(),r("p",{key:0,class:"text-gray-800",innerHTML:l.value?.description},null,8,de)):_("",!0)])):(n(),r("div",ue,[(n(!0),r(g,null,y(Array.from({length:10},(s,u)=>u),s=>(n(),r("div",pe))),256))]))]),m.value?(n(),r("div",me,[t[6]||(t[6]=e("h3",{class:"text-lg font-bold mb-2"},"قسمت بعدی",-1)),e("h4",ve,d(m.value.title),1),e("p",_e,d(m.value.small_description),1),E(i,{to:{name:"show_episode",params:{course_link:o.course_link,episode_link:m.value.link}},class:"block bg-white text-blue-600 font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center"},{default:A(()=>[...t[5]||(t[5]=[U(" مشاهده قسمت بعدی ",-1),e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})],-1)])]),_:1},8,["to"])])):_("",!0)]),e("aside",he,[e("div",ge,[t[7]||(t[7]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"لیست اپیزودها",-1)),e("ul",ye,[(n(!0),r(g,null,y(f.value,(s,u)=>(n(),r("li",{key:u,class:j(["",s.link===l.value?.link?"bg-blue-50 border-r-4 border-blue-500":"hover:bg-gray-50"])},[E(i,{to:{name:"show_episode",params:{course_link:o.course_link,episode_link:s.link}},class:"p-3 rounded-lg cursor-pointer transition-colors block"},{default:A(()=>[e("h3",be,d(s.title),1)]),_:2},1032,["to"])],2))),128))])])])])])])}}};export{we as default};
