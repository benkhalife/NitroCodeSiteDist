import{P as f}from"./API-F9u_t1LY.js";import{_ as h,r as i,b as v,j as S,c as r,o as c,f as u,t as k,i as I}from"./index-B4xQfbQ6.js";const y={class:"callback-container"},b={key:0},w={key:1,class:"error"},P={__name:"AuthGoogleCallback",setup(x){const l=S();I();const t=i(!0),e=i(null);return v(async()=>{const o=new URLSearchParams(window.location.search),a=o.get("code"),n=o.get("state"),_=sessionStorage.getItem("google_auth_state");if(!n||n!==_){e.value="خطای امنیتی: State معتبر نیست.",t.value=!1,setTimeout(()=>l.push("/login?error=csrf"),2e3);return}if(sessionStorage.removeItem("google_auth_state"),console.log("get code",a),a)try{const{client_api_token:s,picture:m,first_name:g,last_name:p,email:d}=await f("site/auth/get-google-access-token",{code:a});localStorage.setItem("client_api_token",s),localStorage.setItem("picture",m),localStorage.setItem("first_name",g),localStorage.setItem("last_name",p),localStorage.setItem("email",d),l.replace({name:"login_success_message"})}catch(s){console.error("Login failed:",s),e.value="ورود با گوگل موفقیت‌آمیز نبود. لطفاً دوباره تلاش کنید.",t.value=!1}else e.value="شما اجازه دسترسی را ندادید.",t.value=!1}),(o,a)=>(c(),r("div",y,[t.value?(c(),r("p",b,"در حال ورود شما...")):u("",!0),e.value?(c(),r("p",w,k(e.value),1)):u("",!0)]))}},A=h(P,[["__scopeId","data-v-a0828eac"]]);export{A as default};
