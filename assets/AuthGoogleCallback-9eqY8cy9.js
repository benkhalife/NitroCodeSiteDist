import{_ as h,r as _,b as v,j as S,P as k,c as r,o as l,f as u,t as w,i as I}from"./index-DFVFHNAl.js";const b={class:"callback-container"},y={key:0},P={key:1,class:"error"},x={__name:"AuthGoogleCallback",setup(C){const c=S();I();const t=_(!0),e=_(null);return v(async()=>{const a=new URLSearchParams(window.location.search),o=a.get("code"),n=a.get("state"),g=sessionStorage.getItem("google_auth_state");if(!n||n!==g){e.value="خطای امنیتی: State معتبر نیست.",t.value=!1,setTimeout(()=>c.push("/login?error=csrf"),2e3);return}if(sessionStorage.removeItem("google_auth_state"),console.log("get code",o),o)try{const{client_api_token:s,picture:m,first_name:d,last_name:f,email:p}=await k("site/auth/get-google-access-token",{code:o});localStorage.setItem("client_api_token",s),localStorage.setItem("picture",m),localStorage.setItem("first_name",d),localStorage.setItem("last_name",f),localStorage.setItem("email",p);const i=window.localStorage.getItem("redirect_after_login")||!1;if(i){window.localStorage.removeItem("redirect_after_login"),window.location.href=i;return}else c.replace({name:"login_success_message"})}catch(s){console.error("Login failed:",s),e.value="ورود با گوگل موفقیت‌آمیز نبود. لطفاً دوباره تلاش کنید.",t.value=!1}else e.value="شما اجازه دسترسی را ندادید.",t.value=!1}),(a,o)=>(l(),r("div",b,[t.value?(l(),r("p",y,"لطفا صبر کنید ...")):u("",!0),e.value?(l(),r("p",P,w(e.value),1)):u("",!0)]))}},A=h(x,[["__scopeId","data-v-b64b6c1b"]]);export{A as default};
