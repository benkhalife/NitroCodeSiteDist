import{r as u,q as S,b as I,s as C,w as D,c as n,o as r,d as e,t as c,n as _,f as h,F as g,g as y,e as E,l as L,k as M,i as Q,u as V,v as N,x as H,j as U,m as j}from"./index-Dtn8wZOA.js";const Y={class:"min-h-screen bg-gray-50"},z={class:"bg-white shadow-sm border-b"},F={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},K={class:"text-2xl font-bold text-gray-900"},O={"aria-label":"Breadcrumb",class:"breadcrumbs text-primary text-sm mt-4",dir:"rtl"},G={itemscope:"",itemtype:"https://schema.org/BreadcrumbList"},J={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},W=["href"],X={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem",class:"text-gray-700"},Z={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},q={class:"lg:flex lg:gap-8"},ee={class:"lg:w-7/10"},te={class:"relative aspect-video"},se=["poster"],oe={key:0,class:"pb-1 px-2"},ie=["value"],le={class:"bg-white rounded-lg shadow-md p-6 mb-6 mt-6"},ae={key:0,class:"prose-sm md:prose lg:prose-xl text-justify max-w-none"},ne=["innerHTML"],re={key:1,class:"flex flex-col gap-10"},ue={class:"skeleton h-4 w-full"},ce={key:0,class:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white"},de={class:"text-xl mb-2"},pe={class:"mb-4 opacity-90"},me={class:"lg:w-3/10 mb-8 lg:mb-0"},ve={class:"bg-white rounded-lg shadow-md p-4"},_e={class:"space-y-2"},he={class:"font-medium text-gray-900"},ge={class:"skeleton p-8 w-full"},fe={__name:"ShowEpisodeView",setup(ye){const p=Q();U();const k=u(!0),v=u(null),l=u(null),m=u(null),b=u([]),T=u(null);u("");const a=u(null),f=u([]),w=u(-1);S([]);const x=async()=>{try{k.value=!0;const{course_link:o,episode_link:t}=p.params,i=await fetch(`https://api.nitrocode.ir/site/course/${o}/episode/${t}`,{method:"POST"}).then(s=>s.json());i.ok&&(v.value=i.product,l.value=i.episode,m.value=i.next_episode,b.value=i.episode_list,V({title:l.value.meta_title,meta:[{property:"og:title",content:l.value.meta_title},{property:"og:description",content:l.value.meta_description},{property:"og:image",content:A()},{name:"description",content:l.value.meta_description},{name:"keywords",content:l.value.meta_keywords}],link:[{rel:"canonical",href:l.value.meta_canonical||`https://nitrocode.ir/course/${v.value.link}/${l.value.link}`}]}),N(()=>{B(),setTimeout(()=>{window.isLoading.value=!1},100)}))}catch(o){console.error("Error fetching episode data:",o)}finally{k.value=!1}},A=()=>`${`https://api.nitrocode.ir/site/get-file/${p.params.course_link}/episode/${p.params.episode_link}`}/${l.value.video_poster}`,B=async()=>{try{const{MediaPlayer:o}=await H(async()=>{const{MediaPlayer:s}=await import("./dash.all.min-D3TBEzDq.js");return{MediaPlayer:s}},[]);a.value&&(a.value.destroy(),a.value=null,console.log("destroy old player"));const i=`${`https://api.nitrocode.ir/site/get-file/${p.params.course_link}/episode/${p.params.episode_link}`}/${l.value.video_target}`;a.value=o().create(),a.value.initialize(document.querySelector("#videoPlayer"),i,!1),a.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{audio:!0,video:!0}}}}),a.value.on(o.events.QUALITY_CHANGE_REQUESTED,s=>{console.log("تغییر کیفیت درخواست شد:",s)}),a.value.on(o.events.PLAYBACK_METADATA_LOADED,s=>{console.log("Load Video METADATA"),f.value=$(a.value)}),a.value.on(o.events.QUALITY_CHANGE_RENDERED,s=>{console.info("QUALITY :",s?.newRepresentation?.height)})}catch(o){console.error(o)}},$=o=>{if(!o)return console.log("player not init in getAvailableBitrates",o),[];try{return(o.getRepresentationsByType("video")||[]).map((i,s)=>({index:s,bitrate:i.bitrate,bitrateInKbit:i.bitrateInKbit,width:i.width,height:i.height,id:i.id,label:`${i.height}p`}))}catch(t){return console.error("خطا در دریافت لیست کیفیت‌ها:",t),[]}},P=o=>{if(!a.value)return;const t=o.target.value;t===""?(console.log("Set Auto (ABR)"),a.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!0}}}}),w.value=-1):(console.log("Change by user:",t),a.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!1}}}}),R(a.value,t)&&(w.value=t))},R=(o,t)=>{if(!o)return!1;try{const i=o.getRepresentationsByType("video")||[],s=i.find(d=>d.id==t);return s?(o.setRepresentationForTypeById("video",s.id,!0),console.log("کیفیت دستی تنظیم شد روی:",s),!0):(console.warn("Representation موردنظر پیدا نشد:",t,i),!1)}catch(i){return console.error("خطا در تغییر کیفیت:",i),!1}};return x(),I(()=>{window.scrollTo(0,0)}),C(()=>{a.value&&(a.value.destroy(),a.value=null)}),D(()=>p.params.episode_link,(o,t)=>{o&&o!==t&&(x(),window.scrollTo(0,0))}),(o,t)=>{const i=M("router-link");return r(),n("div",Y,[e("header",z,[e("div",F,[e("h1",K,c(l.value?.title||"در حال بارگذاری..."),1),e("nav",O,[e("ul",G,[t[2]||(t[2]=e("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[e("a",{itemprop:"item",href:"/"},[e("span",{itemprop:"name"},"صفحه اصلی")]),e("meta",{itemprop:"position",content:"1"})],-1)),t[3]||(t[3]=e("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[e("a",{itemprop:"item",href:"/courses"},[e("span",{itemprop:"name"},"دوره‌ها")]),e("meta",{itemprop:"position",content:"2"})],-1)),e("li",J,[e("a",{itemprop:"item",href:`/courses/${v.value?.link||""}`},[e("span",{itemprop:"name",class:_({"skeleton w-56 p-3":!l.value?.title})},c(v.value?.title||""),3)],8,W),t[0]||(t[0]=e("meta",{itemprop:"position",content:"3"},null,-1))]),e("li",X,[e("span",{itemprop:"name",class:_({"skeleton w-56 p-3":!l.value?.title})},c(l.value?.title||""),3),t[1]||(t[1]=e("meta",{itemprop:"position",content:"4"},null,-1))])])])])]),e("main",Z,[e("div",q,[e("div",ee,[e("div",{class:_(["rounded-lg shadow-md overflow-hidden shadow-lg",{skeleton:!l.value?.title}])},[e("div",te,[l.value?(r(),n("video",{key:0,id:"videoPlayer",ref_key:"videoPlayer",ref:T,class:"w-full h-full",controls:"",poster:A()}," مرورگر شما از پخش ویدیو پشتیبانی نمی‌کند لطفا از آخرین نسخه از مرورگر گوگل کروم استفاده کنید ",8,se)):h("",!0)]),f.value.length>1?(r(),n("div",oe,[e("select",{class:"select select-ghost select-sm",onChange:P},[t[4]||(t[4]=e("option",{value:""},"انتخاب کیفیت : اتوماتیک",-1)),(r(!0),n(g,null,y(f.value,(s,d)=>(r(),n("option",{key:d,value:s.id},c(s.label)+" "+c(s.label=="1080p"?" (کیفیت عالی)":"")+" "+c(s.label=="720p"?" (کیفیت خوب)":"")+" "+c(s.label=="480p"?" (کیفیت کم)":""),9,ie))),128))],32)])):h("",!0)],2),e("div",le,[l.value?.description?(r(),n("div",ae,[l.value?.description?(r(),n("p",{key:0,class:"text-gray-800",innerHTML:l.value?.description},null,8,ne)):h("",!0)])):(r(),n("div",re,[(r(!0),n(g,null,y(Array.from({length:10},(s,d)=>d),s=>(r(),n("div",ue))),256))]))]),m.value?(r(),n("div",ce,[t[6]||(t[6]=e("h3",{class:"text-lg font-bold mb-2"},"قسمت بعدی",-1)),e("h4",de,c(m.value.title),1),e("p",pe,c(m.value.small_description),1),E(i,{to:{name:"show_episode",params:{course_link:o.course_link,episode_link:m.value.link}},class:"block bg-white text-blue-600 font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center"},{default:L(()=>[...t[5]||(t[5]=[j(" مشاهده قسمت بعدی ",-1),e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})],-1)])]),_:1},8,["to"])])):h("",!0)]),e("aside",me,[e("div",ve,[t[7]||(t[7]=e("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"لیست اپیزودها",-1)),e("ul",_e,[b.value.length?(r(!0),n(g,{key:0},y(b.value,(s,d)=>(r(),n("li",{key:d,class:_(["",s.link===l.value?.link?"bg-blue-50 border-r-4 border-blue-500":"hover:bg-gray-50"])},[E(i,{to:{name:"show_episode",params:{course_link:o.course_link,episode_link:s.link}},class:"p-3 rounded-lg cursor-pointer transition-colors block"},{default:L(()=>[e("h3",he,c(s.title),1)]),_:2},1032,["to"])],2))),128)):(r(!0),n(g,{key:1},y(Array.from({length:10},(s,d)=>d+1),s=>(r(),n("li",ge))),256))])])])])])])}}};export{fe as default};
