import{c as r,o as n,d as i,_ as X,a as ve,r as v,v as me,h as S,I as b,b as fe,x as ge,w as _e,n as y,t as f,f as k,e as $,p as K,l as R,k as he,F as D,g as I,G as A,i as be,P as J,s as ye,j as we,A as xe,D as T,u as ke,y as $e,m as W}from"./index-V7whs7ie.js";import{S as Z}from"./sweetalert2.esm.all-NNS-RXd7.js";import{r as Ae}from"./ShoppingCartIcon-XNSYlLhF.js";function Te(j,g){return n(),r("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}const Ee={},Le={viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg",fill:"none"};function Be(j,g){return n(),r("svg",Le,[...g[0]||(g[0]=[ve('<g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path stroke="#e0bc0b" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M27 7H5a2 2 0 00-2 2v14a2 2 0 002 2h22a2 2 0 002-2V9a2 2 0 00-2-2z"></path> <path stroke="#e0bc0b" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 13l3 6.5 3-6.5M16.5 13v6.5M20.5 17.275h1.48c.651 0 1.277-.275 1.721-.75a2.338 2.338 0 00.215-2.932 1.394 1.394 0 00-1.14-.593H20.5v4.275zm0 0V19.5"></path></g>',3)])])}const Pe=X(Ee,[["render",Be]]),Se={class:"min-h-screen bg-gray-50"},De={class:"bg-white shadow-sm border-b border-gray-200"},Ie={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},Ce={key:1,class:"sr-only"},Ve={"aria-label":"Breadcrumb",class:"breadcrumbs text-primary text-sm mt-4",dir:"rtl"},Me={itemscope:"",itemtype:"https://schema.org/BreadcrumbList"},Ue={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},Ne=["href"],Oe={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem","aria-current":"page",class:"text-gray-700"},Re={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",role:"main"},je={class:"lg:flex lg:gap-8"},ze={class:"lg:w-7/10"},Fe={class:"relative aspect-video"},He=["poster"],Ge={class:"hidden ms:block"},Qe={class:"flex gap-2 md:gap-4 flex flex-col md:flex-row items-center"},Ye={key:0,class:"pb-1 px-2"},Ke=["value"],Je={class:"bg-white rounded-lg shadow-md p-6 mb-6 mt-6","aria-labelledby":"episode-title"},We={key:0,class:"prose xl:prose-lg 2xl:prose-xl text-justify max-w-none"},Ze=["innerHTML"],Xe={key:1,class:"flex flex-col gap-10"},qe={class:"skeleton h-4 w-full"},et={key:0,class:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white"},tt={class:"text-xl mb-2"},ot={class:"mb-4 opacity-90"},it={class:"lg:w-3/10 mb-8 lg:mb-0","aria-label":"فهرست اپیزودها"},st={class:"bg-white rounded-lg shadow-md p-4"},lt={class:"space-y-2"},at={class:"font-medium text-gray-900"},rt={class:"skeleton p-8 w-full"},nt={__name:"ShowEpisodeView",setup(j){const g=be(),C=we(),z=v(!0),c=v(null),e=v(null),h=v(null),V=v([]),q=v(null);v("");const B=v(!1),ee=v({}),u=v(null),M=v([]),F=v(-1);me([]);const te=o=>{if(!e.value)return"";let t=`${A()}site/active-user/get-course-video-file/${e.value.product_id}/${e.value.id}`,s=`${t}/${e.value.video_type}/${o}`;return b()==!1&&(t=`${A()}site/get-course-video-file/${e.value.product_id}/${e.value.id}`,s=`${t}/${e.value.video_type}/${o}?v=8`),s},U=()=>e.value?`${`${A()}site/get-file/${g.params.course_link}/episode/${g.params.episode_link}`}/${e.value.video_poster}`:"",P=o=>{if(!o||isNaN(Number(o))||Number(o)<=0)return;let t=Math.floor(Number(o));const s=Math.floor(t/3600);t-=s*3600;const l=Math.floor(t/60);t-=l*60;let a="PT";return s>0&&(a+=`${s}H`),l>0&&(a+=`${l}M`),(t>0||a==="PT")&&(a+=`${t}S`),a},oe=()=>{if(!e.value||!c.value)return;const o="https://nitrocode.ir/courses/",t=e.value.meta_canonical||`${o}${c.value.link}/${e.value.link}`,s=re?.value||null,l=U()?encodeURI(U()):void 0,a=e.value?.meta_description&&e.value.meta_description.length>200||e.value?.description&&e.value.description.length>200,p=e.value?.preview_seconds||e.value?.preview_duration_seconds,E=!!(e.value?.video_preview_target||p&&Number(p)>0);let w=e.value?.meta_robots;w||(w=(["free_with_login","vip_preview","vip"].indexOf(e.value.display_status)>-1&&b()==!1||(e.value.display_status=="vip"||e.value.display_status=="vip_preview")&&b()&&e.value.user_has_access==!1?a||E:!0)?"index, follow":"noindex, noarchive, follow");const m=[{property:"og:title",content:e.value.meta_title||e.value.title},{property:"og:description",content:e.value.meta_description||e.value.description||""},{property:"og:image",content:l||""},{name:"description",content:e.value.meta_description||e.value.description||""},{name:"keywords",content:e.value.meta_keywords||""}];s&&(m.push({property:"og:video",content:s}),m.push({property:"og:video:type",content:"application/dash+xml"})),m.push({name:"robots",content:w}),m.push({name:"twitter:card",content:"summary_large_image"}),m.push({name:"twitter:title",content:e.value.meta_title||e.value.title}),m.push({name:"twitter:description",content:e.value.meta_description||e.value.description||""}),m.push({name:"twitter:image",content:l||""});const L={"@context":"https://schema.org","@graph":[]},de={"@type":"Course",name:c.value.title||e.value.meta_title,description:c.value.small_description||e.value.meta_description||"",url:`${o}${c.value.link}`,provider:{"@type":"Organization",name:"NitroCode",url:"https://nitrocode.ir"}};L["@graph"].push(de);const Q={"@type":"Organization",name:"NitroCode"};if(G?.value===!0){const d={"@type":"VideoObject",name:e.value.meta_title||e.value.title,description:e.value.meta_description||e.value.description||"",thumbnailUrl:l,embedUrl:t,isAccessibleForFree:!1,inLanguage:"fa",mainEntityOfPage:t,publisher:Q};if(s){const _={"@type":"VideoObject",name:`${e.value.meta_title||e.value.title} — پیش‌نمایش`,description:e.value.meta_description||e.value.description||"",thumbnailUrl:l,contentUrl:s,embedUrl:t,inLanguage:"fa",isAccessibleForFree:!0,mainEntityOfPage:t,duration:P(e.value?.free_demo_time),uploadDate:T(e.value.created_at),dateModified:T(e.value.updated_at)},pe=p||e.value.preview_duration||null,Y=P(pe);Y&&(_.duration=Y),d.hasPart=_}const x=P(e.value?.duration);x&&(d.duration=x),e.value?.created_at&&(d.uploadDate=T(e.value.created_at)),e.value?.updated_at&&(d.dateModified=T(e.value.updated_at)),Object.keys(d).forEach(_=>d[_]===void 0&&delete d[_]),L["@graph"].push(d)}else{const d={"@type":"VideoObject",name:e.value.meta_title||e.value.title,description:e.value.meta_description||e.value.description||"",thumbnailUrl:l,contentUrl:s||void 0,embedUrl:t,isAccessibleForFree:!0,inLanguage:"fa",mainEntityOfPage:t,publisher:Q},x=P(e.value?.duration);x&&(d.duration=x),e.value?.created_at&&(d.uploadDate=T(e.value.created_at)),e.value?.updated_at&&(d.dateModified=T(e.value.updated_at)),Object.keys(d).forEach(_=>d[_]===void 0&&delete d[_]),L["@graph"].push(d)}const ce={"@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"صفحه اصلی",item:"https://nitrocode.ir/"},{"@type":"ListItem",position:2,name:"دوره‌ها",item:o},{"@type":"ListItem",position:3,name:c.value.title||"",item:`${o}${c.value.link}`},{"@type":"ListItem",position:4,name:e.value.title||"",item:t}]};L["@graph"].push(ce),ke({title:e.value.meta_title||e.value.title,meta:m,link:[{rel:"canonical",href:t}].concat(h.value?[{rel:"next",href:`${o}${c.value.link}/${h.value.link}`}]:[]),script:[{type:"application/ld+json",children:JSON.stringify(L)}]})},H=async()=>{try{z.value=!0;const{course_link:o,episode_link:t}=g.params;let s=null;b()?s=await J(`site/active-user/course/${o}/episode/${t}`):s=await J(`site/course/${o}/episode/${t}`),s.ok&&(c.value=s.product,e.value=s.episode,h.value=s.next_episode,V.value=s.episode_list,ee.value=s.author||{},ye(()=>{oe(),ie(),setTimeout(()=>{window.isLoading.value=!1},100)}))}catch(o){console.error("Error fetching episode data:",o)}finally{z.value=!1}},ie=async()=>{try{const{MediaPlayer:o}=await $e(async()=>{const{MediaPlayer:p}=await import("./dash.all.min-D3TBEzDq.js");return{MediaPlayer:p}},[]);u.value&&(u.value.destroy(),u.value=null,console.log("destroy old player"));let t=e.value.video_target,s=`${A()}site/active-user/get-course-video-file/${e.value.product_id}/${e.value.id}`,l=`${s}/${e.value.video_type}/${t}`;b()==!1&&(s=`${A()}site/get-course-video-file/${e.value.product_id}/${e.value.id}`,l=`${s}/${e.value.video_type}/${t}?v=8`),(N.value||O.value)&&(t=e.value.video_preview_target||"preview.mpd",s=`${A()}site/get-course-video-file/${e.value.product_id}/${e.value.id}`,l=`${s}/${e.value.video_type}/${t}?v=8`),u.value=o().create(),u.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{audio:!0,video:!0}}}}),u.value.initialize(document.querySelector("#videoPlayer"),l,!1),u.value.on(o.events.QUALITY_CHANGE_REQUESTED,p=>{console.log("تغییر کیفیت درخواست شد:",p)}),u.value.on(o.events.PLAYBACK_METADATA_LOADED,p=>{console.log("Load Video METADATA"),M.value=se(u.value)}),u.value.on(o.events.QUALITY_CHANGE_RENDERED,p=>{console.info("QUALITY :",p?.newRepresentation?.height)});let a=!1;u.value.on(o.events.PLAYBACK_TIME_UPDATED,p=>{const E=document.querySelector("#videoPlayer");if(E&&!a){const w=E.currentTime,m=E.duration;m-w<=5&&m>0&&w>0&&(a=!0,console.log("Video is about to end (within 2 seconds)"),B.value=!0)}}),u.value.on(o.events.PLAYBACK_STARTED,p=>{a=!1}),u.value.on(o.events.PLAYBACK_ENDED,p=>{console.log("Video ended completely"),a=!1,B.value=!0})}catch(o){console.error(o)}},se=o=>{if(!o)return console.log("player not init in getAvailableBitrates",o),[];try{return(o.getRepresentationsByType("video")||[]).map((s,l)=>({index:l,bitrate:s.bitrate,bitrateInKbit:s.bitrateInKbit,width:s.width,height:s.height,id:s.id,label:`${s.height}p`}))}catch(t){return console.error("خطا در دریافت لیست کیفیت‌ها:",t),[]}},le=o=>{if(!u.value)return;const t=o.target.value;t===""?(console.log("Set Auto (ABR)"),u.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!0}}}}),F.value=-1):(console.log("Change by user:",t),u.value.updateSettings({streaming:{abr:{autoSwitchBitrate:{video:!1}}}}),ae(u.value,t)&&(F.value=t))},ae=(o,t)=>{if(!o)return!1;try{const s=o.getRepresentationsByType("video")||[],l=s.find(a=>a.id==t);return l?(o.setRepresentationForTypeById("video",l.id,!0),console.log("کیفیت دستی تنظیم شد روی:",l),!0):(console.warn("Representation موردنظر پیدا نشد:",t,s),!1)}catch(s){return console.error("خطا در تغییر کیفیت:",s),!1}},N=S(()=>e.value?["free_with_login","vip_preview","vip"].indexOf(e.value.display_status)>-1&&b()==!1:!1),O=S(()=>e.value?!!((e.value.display_status=="vip_preview"||e.value.display_status=="vip")&&b()&&e?.value?.user_has_access==!1):!1),G=S(()=>N.value||O.value),re=S(()=>{if(!e.value)return"";let o=e.value.video_target;return G.value&&(o=e.value.video_preview_target||"preview.mpd"),te(o)});H(),fe(()=>{window.scrollTo(0,0)}),ge(()=>{u.value&&(u.value.destroy(),u.value=null)}),_e(()=>g.params.episode_link,(o,t)=>{o&&o!==t&&(H(),window.scrollTo(0,0))});const ne=()=>{window.localStorage.setItem("redirect_after_login",g.fullPath),C.push({name:"login"})},ue=async()=>{try{const o=await xe("site/active-user/course-shopping/add-to-cart/"+c.value.id);(o.ok||o.ok==!1&&o.carts&&o.carts.length)&&Z.fire({icon:"success",title:"دوره به سبد خرید اضافه شد",text:"می‌توانید پرداخت را انجام دهید یا سبد خرید را مشاهده کنید.",showCancelButton:!0,confirmButtonText:"پرداخت و مشاهده‌ی دوره",cancelButtonText:"مشاهده سبد خرید"}).then(t=>{t.isConfirmed?C.push({name:"user_cart",hash:"#checkout_now"}):t.dismiss===Z.DismissReason.cancel&&C.push({name:"user_cart"})})}catch(o){console.error(o)}};return(o,t)=>{const s=he("router-link");return n(),r("div",Se,[i("header",De,[i("div",Ie,[e.value?(n(),r("h1",{key:0,class:y(["text-xl md:text-2xl font-bold text-gray-900",{"skeleton w-56 p-4":!e.value?.title}])},f(e.value?.title||""),3)):(n(),r("h1",Ce,"در حال بارگذاری اپیزود...")),i("nav",Ve,[i("ul",Me,[t[4]||(t[4]=i("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[i("a",{itemprop:"item",href:"/"},[i("span",{itemprop:"name"},"صفحه اصلی")]),i("meta",{itemprop:"position",content:"1"})],-1)),t[5]||(t[5]=i("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[i("a",{itemprop:"item",href:"/courses"},[i("span",{itemprop:"name"},"دوره‌ها")]),i("meta",{itemprop:"position",content:"2"})],-1)),i("li",Ue,[i("a",{itemprop:"item",href:`/courses/${c.value?.link||""}`},[i("span",{itemprop:"name",class:y({"skeleton w-56 p-3":!e.value?.title})},f(c.value?.title||""),3)],8,Ne),t[2]||(t[2]=i("meta",{itemprop:"position",content:"3"},null,-1))]),i("li",Oe,[i("span",{itemprop:"name",class:y({"skeleton w-56 p-3":!e.value?.title})},f(e.value?.title||""),3),t[3]||(t[3]=i("meta",{itemprop:"position",content:"4"},null,-1))])])])])]),i("main",Re,[i("div",je,[i("div",ze,[i("article",{class:y(["rounded-lg shadow-md overflow-hidden shadow-lg",{skeleton:!e.value?.title}]),"aria-labelledby":"episode-title"},[i("div",Fe,[e.value?(n(),r("video",{key:0,id:"videoPlayer",ref_key:"videoPlayer",ref:q,class:"w-full h-full",controls:"",poster:U(),preload:"metadata",playsinline:""}," مرورگر شما از پخش ویدیو پشتیبانی نمی‌کند لطفا از آخرین نسخه از مرورگر گوگل کروم استفاده کنید ",8,He)):k("",!0),N.value?(n(),r("div",{key:1,class:y(["pulse-opacity-smooth top-0 left-0 w-full gap-2 flex justify-center lg:justify-between p-4 absolute z-10 items-center duration-500 h-20",{"h-full":B.value}])},[t[7]||(t[7]=i("div",{class:"flex-1"},[i("div",{class:"text-sm sm:text-md md:text-lg lg:text-xl font-bold p-2 text-teal-300"}," برای مشاهده‌ی کامل این ویدیو لطفا وارد سایت (حساب کاربری) شوید "),i("p")],-1)),i("div",null,[i("button",{onClick:t[0]||(t[0]=l=>ne()),class:"btn btn-sm md:btn-md btn-primary"},[t[6]||(t[6]=i("div",null,"ورود و مشاهده",-1)),i("div",null,[$(K(Te),{class:"size-5 animate-pulse text-green-300"})])])])],2)):k("",!0),O.value?(n(),r("div",{key:2,class:y(["pulse-opacity-smooth top-0 left-0 w-full gap-1 md:gap-2 lg:gap-8 flex flex-col justify-center p-2 ms:p-4 absolute z-10 items-center duration-500",{"h-full":B.value}])},[i("div",Ge,[$(Pe,{class:"size-8 md:size-12 fill-yello-700 text-yellow-700"})]),t[10]||(t[10]=i("div",{class:"text-md sm:text-lg md:text-xl lg:text-2xl font-bold text-center p-2 text-white"}," بعد از خرید این دوره تمام قسمت‌های آن قابل مشاهده است ",-1)),i("div",Qe,[i("button",{onClick:t[1]||(t[1]=l=>ue()),class:"text-sm md:text-md lg:text-lg hover:bg-black duration-200 cursor-pointer flex items-center gap-2 p-2 border-2 border-[#e0bc0b] text-[#e0bc0b] font-bold rounded-lg items-center"},[t[8]||(t[8]=i("div",null,"خرید این دوره و مشاهده",-1)),i("div",null,[$(K(Ae),{class:"size-6 animate-pulse text-green-[#e0bc0b]"})])]),$(s,{to:"/courses/"+c.value?.link,class:"text-sm md:text-md lg:text-lg opacity-80 hover:bg-black duration-200 cursor-pointer flex items-center gap-2 p-2 border-2 border-gray-300 text-gray-300 font-bold rounded-lg items-center"},{default:R(()=>[...t[9]||(t[9]=[W(" مشاهده‌ي اطلاعات دوره ",-1)])]),_:1},8,["to"])])],2)):k("",!0)]),M.value.length>1?(n(),r("div",Ye,[i("select",{class:"select select-ghost select-sm",onChange:le},[t[11]||(t[11]=i("option",{value:""},"انتخاب کیفیت : اتوماتیک",-1)),(n(!0),r(D,null,I(M.value,(l,a)=>(n(),r("option",{key:a,value:l.id},f(l.label)+" "+f(l.label=="1080p"?" (کیفیت عالی)":"")+" "+f(l.label=="720p"?" (کیفیت خوب)":"")+" "+f(l.label=="480p"?" (کیفیت کم)":""),9,Ke))),128))],32)])):k("",!0)],2),i("section",Je,[t[12]||(t[12]=i("h2",{id:"episode-title",class:"sr-only"},"اطلاعات اپیزود",-1)),e.value?.description?(n(),r("div",We,[e.value?.description?(n(),r("p",{key:0,class:"text-gray-800",innerHTML:e.value?.description},null,8,Ze)):k("",!0)])):(n(),r("div",Xe,[(n(!0),r(D,null,I(Array.from({length:10},(l,a)=>a),l=>(n(),r("div",qe))),256))]))]),h.value?(n(),r("div",et,[t[14]||(t[14]=i("h3",{class:"text-lg font-bold mb-2"},"قسمت بعدی",-1)),i("h4",tt,f(h.value.title),1),i("p",ot,f(h.value.small_description),1),$(s,{to:{name:"show_episode",params:{course_link:o.course_link,episode_link:h.value.link}},class:"block bg-white text-blue-600 font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center"},{default:R(()=>[...t[13]||(t[13]=[W(" مشاهده قسمت بعدی ",-1),i("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[i("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14 5l7 7m0 0l-7 7m7-7H3"})],-1)])]),_:1},8,["to"])])):k("",!0)]),i("aside",it,[i("div",st,[t[15]||(t[15]=i("h2",{class:"text-lg font-semibold text-gray-900 mb-4"},"لیست اپیزودها",-1)),i("ul",lt,[V.value.length?(n(!0),r(D,{key:0},I(V.value,(l,a)=>(n(),r("li",{key:a,class:y(["",l.link===e.value?.link?"bg-blue-50 border-r-4 border-blue-500":"hover:bg-gray-50"])},[$(s,{to:{name:"show_episode",params:{course_link:o.course_link,episode_link:l.link}},class:"p-3 rounded-lg cursor-pointer transition-colors block"},{default:R(()=>[i("h3",at,f(l.title),1)]),_:2},1032,["to"])],2))),128)):(n(!0),r(D,{key:1},I(Array.from({length:10},(l,a)=>a+1),l=>(n(),r("li",rt))),256))])])])])])])}}},pt=X(nt,[["__scopeId","data-v-9934ea91"]]);export{pt as default};
