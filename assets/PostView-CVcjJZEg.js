import{r as c,h as b,b as N,w as O,x as G,c as a,o as r,d as t,z as h,t as u,f as g,F as E,g as L,m as x,q as H,B as I,C as W,P as Y,i as K,s as S,G as T,j as Q}from"./index-CI7oUU-7.js";const X={class:"min-h-screen bg-gray-50"},Z={class:"container mx-auto p-1 sm:px-4 py-4 sm:py-8 max-w-4xl"},ee={"aria-label":"Breadcrumb",class:"breadcrumbs text-primary text-sm mt-4 pr-4",dir:"rtl"},te={itemscope:"",itemtype:"https://schema.org/BreadcrumbList"},se={itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem",class:"text-gray-700"},le={itemprop:"name"},oe={id:"main-content",role:"main",tabindex:"-1"},ae={key:0,class:"bg-white rounded-xl shadow-md overflow-hidden","aria-busy":"true"},re={key:1,class:"bg-red-50 border-l-4 border-red-500 p-4 rounded-lg",role:"alert","aria-live":"assertive"},ne={class:"flex items-center"},ie={class:"text-red-700"},de={key:2,class:"bg-white rounded-xl shadow-md overflow-hidden",itemscope:"",itemtype:"https://schema.org/Article"},ue={class:"relative"},me=["src","alt"],ce={class:"absolute bottom-0 left-0 right-0 p-2 sm:p-6 text-white"},pe={id:"post-title",class:"text-xl sm:text-2xl md:text-3xl font-bold mb-2",itemprop:"headline"},ge={class:"flex flex-wrap gap-4 text-sm","aria-hidden":"false"},fe={class:"flex items-center gap-1"},ve=["datetime"],be={class:"flex items-center gap-1"},he={class:"p-2 sm:p-4 md:p-8"},xe={key:0,class:"mx-auto max-w-2xl bg-base-200/50 p-2 rounded-xl","aria-labelledby":"audio-heading"},ye=["aria-label"],we=["src"],_e=["innerHTML"],ke={class:"mt-10 pt-6 border-t border-gray-200 flex flex-col sm:flex-row justify-between gap-4"},Ee=["aria-label"],Le=["aria-label"],Ie={class:"mt-12"},Pe={class:"bg-white rounded-xl shadow-md p-6 mb-8"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Ce={class:"mb-4"},Me={key:0,class:"mt-4 text-sm text-green-600",role:"status","aria-live":"polite"},Ae={key:0,class:"space-y-6"},Se={class:"flex justify-between items-start mb-3"},Te={class:"flex items-center"},De={class:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold","aria-hidden":"true"},je={class:"mr-3"},Be={class:"font-semibold text-gray-800"},qe={class:"text-gray-500 text-sm"},Ue={class:"flex items-center text-yellow-400","aria-hidden":"true"},Ve={class:"text-gray-700"},Re={key:1,class:"bg-gray-100 rounded-xl p-8 text-center"},Je={__name:"PostView",setup(ze){const P=K(),D=Q(),m=c([]),o=c(null),y=c(!1),p=c(null),$=c(!1),d=c({name:"",email:"",text:""}),f=c([]),w=c(""),C=async()=>{y.value=!0,p.value=null;try{const s=await Y(`site/post/${P.params.link}`);if(s.ok&&s.post){o.value=s.post,B(s.post),await S(),j();const e=document.getElementById("main-content");e&&e.focus()}else p.value="پست مورد نظر یافت نشد"}catch(s){p.value="خطا در دریافت اطلاعات پست",console.error(s)}finally{y.value=!1}},j=()=>{try{const s=document.getElementById("post-content");if(!s)return;Array.from(s.querySelectorAll("a")).forEach(l=>{if(l.setAttribute("target","_blank"),l.setAttribute("rel","noopener noreferrer nofollow"),!l.getAttribute("aria-label")){const n=(l.textContent||"").trim();n.length>0&&l.setAttribute("aria-label",`باز کردن لینک: ${n}`)}})}catch(s){console.warn("processDescriptionLinks error",s)}},B=s=>{document.title=s.meta_title||s.title||document.title;const e=s.meta_description||s.small_description||"",l=s.meta_keywords||"برنامه نویسی, توسعه بازی, آموزش";i("name","description",e),i("name","keywords",l),i("name","robots",s.meta_robots||"index,follow"),q(s.meta_canonical||window.location.href),i("property","og:type","article"),i("property","og:title",s.meta_title||s.title),i("property","og:description",e),i("property","og:url",s.meta_canonical||window.location.href),i("property","og:image",v()),i("name","twitter:card","summary_large_image"),i("name","twitter:title",s.meta_title||s.title),i("name","twitter:description",e),i("name","twitter:image",v());const n={"@context":"https://schema.org","@type":"Article",headline:s.meta_title||s.title,description:e,image:[v()],datePublished:s.created_at,dateModified:s.updated_at||s.created_at,mainEntityOfPage:{"@type":"WebPage","@id":s.meta_canonical||window.location.href}};U(n)},i=(s,e,l)=>{if(!l&&l!=="")return;let n=document.querySelector(`meta[${s}='${e}']`);n||(n=document.createElement("meta"),n.setAttribute(s,e),document.head.appendChild(n)),n.content=l},q=s=>{let e=document.querySelector('link[rel="canonical"]');e||(e=document.createElement("link"),e.rel="canonical",document.head.appendChild(e)),e.href=s},U=s=>{try{const e=document.head.querySelector('script[type="application/ld+json"][data-generated="nitrocode"]');e&&e.remove();const l=document.createElement("script");l.type="application/ld+json",l.setAttribute("data-generated","nitrocode"),l.text=JSON.stringify(s),document.head.appendChild(l)}catch(e){console.warn("insertJsonLD error",e)}},V=b(()=>{if(!o.value)return 0;const s=(o.value.description||"").replace(/<[^>]*>/g,""),e=200,l=s.trim()===""?0:s.trim().split(/\s+/).length;return Math.max(1,Math.ceil(l/e))});b(()=>!o.value||m.value.length===0?[]:[...m.value.filter(l=>l.id!==o.value.id)].sort(()=>.5-Math.random()).slice(0,3));const _=b(()=>{if(!o.value||m.value.length===0)return null;const s=m.value.findIndex(e=>e.id===o.value.id);return s<=0?null:m.value[s-1]}),k=b(()=>{if(!o.value||m.value.length===0)return null;const s=m.value.findIndex(e=>e.id===o.value.id);return s===-1||s>=m.value.length-1?null:m.value[s+1]}),M=s=>{D.push(`/posts/${s}`),window.scrollTo(0,0)},R=s=>{if(!s)return"";const e={year:"numeric",month:"long",day:"numeric"};try{return new Date(s).toLocaleDateString("fa-IR",e)}catch{return s}},v=()=>`${T()}${o?.value?.image}`,z=s=>T()+`files/posts/${o.value.id}/${s}`,F=()=>{const s={id:f.value.length+1,name:d.value.name,email:d.value.email,text:d.value.text,date:new Date().toLocaleDateString("fa-IR")};f.value.unshift(s),d.value={name:"",email:"",text:""},w.value="نظر شما با موفقیت ثبت شد!",S(()=>{const e=document.getElementById("main-content");e&&e.focus()})},J=()=>{window.scrollTo({top:0,behavior:"smooth"})},A=()=>{$.value=window.scrollY>300};return N(()=>{C(),window.addEventListener("scroll",A)}),O(()=>P.params.link,async(s,e)=>{s&&s!==e&&await C()}),G(()=>{window.removeEventListener("scroll",A)}),(s,e)=>(r(),a("div",X,[t("div",Z,[t("nav",ee,[t("ul",te,[e[7]||(e[7]=t("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[t("a",{itemprop:"item",href:"/"},[t("span",{itemprop:"name"},"صفحه اصلی")]),t("meta",{itemprop:"position",content:"1"})],-1)),e[8]||(e[8]=t("li",{itemprop:"itemListElement",itemscope:"",itemtype:"https://schema.org/ListItem"},[t("a",{itemprop:"item",href:"/posts"},[t("span",{itemprop:"name"},"مطالب")]),t("meta",{itemprop:"position",content:"2"})],-1)),t("li",se,[t("span",le,u(o.value?.title),1),e[6]||(e[6]=t("meta",{itemprop:"position",content:"3"},null,-1))])])]),t("main",oe,[y.value?(r(),a("div",ae,[e[10]||(e[10]=t("div",{class:"h-64 skeleton","aria-hidden":"true"},null,-1)),(r(!0),a(E,null,L(Array.from({length:7},(l,n)=>n),l=>(r(),a("div",{key:l,class:"p-6"},[...e[9]||(e[9]=[t("div",{class:"h-8 bg-gray-200 rounded w-3/4 mb-4 skeleton","aria-hidden":"true"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded mb-2 skeleton","aria-hidden":"true"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded mb-2 skeleton","aria-hidden":"true"},null,-1),t("div",{class:"h-4 bg-gray-200 rounded mb-2 skeleton","aria-hidden":"true"},null,-1)])]))),128))])):p.value?(r(),a("div",re,[t("div",ne,[e[11]||(e[11]=t("i",{class:"fas fa-exclamation-triangle text-red-500 text-xl ml-3","aria-hidden":"true"},null,-1)),t("p",ie,u(p.value),1)])])):o.value?(r(),a("article",de,[t("header",ue,[t("img",{src:v(),alt:o.value.title,class:"w-full h-64 md:h-96 object-cover",loading:"lazy",onError:e[0]||(e[0]=(...l)=>s.handleImageError&&s.handleImageError(...l)),itemprop:"image"},null,40,me),e[14]||(e[14]=t("div",{class:"absolute inset-0 bg-gradient-to-t from-black/70 to-transparent","aria-hidden":"true"},null,-1)),t("div",ce,[t("h1",pe,u(o.value.title),1),t("div",ge,[t("span",fe,[e[12]||(e[12]=t("i",{class:"far fa-calendar","aria-hidden":"true"},null,-1)),t("time",{datetime:o.value.created_at,itemprop:"datePublished"},u(R(o.value.created_at)),9,ve)]),t("span",be,[e[13]||(e[13]=t("i",{class:"far fa-clock","aria-hidden":"true"},null,-1)),t("span",null,u(V.value)+" دقیقه مطالعه",1)])])])]),t("div",he,[o.value.audio&&o.value.audio.trim()!==""?(r(),a("section",xe,[e[16]||(e[16]=t("h2",{id:"audio-heading",class:"text-lg font-semibold mb-2"},"پخش فایل صوتی",-1)),t("audio",{class:"audio w-full",controls:"",preload:"metadata","aria-label":`پخش فایل صوتی برای ${o.value.title}`},[t("source",{src:z(o.value.audio),type:"audio/mpeg"},null,8,we),e[15]||(e[15]=x(" مرورگر شما از تگ صوت پشتیبانی نمی‌کند. ",-1))],8,ye)])):g("",!0),t("div",{id:"post-content",class:"prose xl:prose-lg 2xl:prose-xl mt-2 max-w-none text-gray-700 text-justify",innerHTML:o.value.description,itemprop:"articleBody"},null,8,_e),t("div",ke,[_.value?(r(),a("button",{key:0,onClick:e[1]||(e[1]=l=>M(_.value.link)),class:"flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors","aria-label":`بارگذاری مطلب قبلی: ${_.value.title}`},[...e[17]||(e[17]=[t("i",{class:"fas fa-arrow-right","aria-hidden":"true"},null,-1),x(" مطلب قبلی ",-1)])],8,Ee)):g("",!0),k.value?(r(),a("button",{key:1,onClick:e[2]||(e[2]=l=>M(k.value.link)),class:"flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors","aria-label":`بارگذاری مطلب بعدی: ${k.value.title}`},[...e[18]||(e[18]=[x(" مطلب بعدی ",-1),t("i",{class:"fas fa-arrow-left","aria-hidden":"true"},null,-1)])],8,Le)):g("",!0)])])])):g("",!0),t("div",Ie,[e[25]||(e[25]=t("h2",{class:"text-2xl font-bold text-gray-800 mb-6 relative pb-3"},[x("نظرات کاربران "),t("span",{class:"absolute bottom-0 right-0 w-16 h-1 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full","aria-hidden":"true"})],-1)),t("div",Pe,[e[23]||(e[23]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"ارسال نظر",-1)),t("form",{onSubmit:H(F,["prevent"])},[t("div",$e,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-gray-700 mb-2"},"نام و نام خانوادگی",-1)),h(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=l=>d.value.name=l),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[I,d.value.name]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-gray-700 mb-2"},"ایمیل",-1)),h(t("input",{type:"email","onUpdate:modelValue":e[4]||(e[4]=l=>d.value.email=l),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[I,d.value.email]])])]),t("div",Ce,[e[21]||(e[21]=t("label",{class:"block text-gray-700 mb-2"},"متن نظر",-1)),h(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=l=>d.value.text=l),rows:"4",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,512),[[I,d.value.text]])]),e[22]||(e[22]=t("button",{type:"submit",class:"bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-2 rounded-lg font-medium transition-all duration-300 hover:shadow-md","aria-label":"ارسال نظر"}," ارسال نظر ",-1))],32),w.value?(r(),a("div",Me,u(w.value),1)):g("",!0)]),f.value.length>0?(r(),a("div",Ae,[(r(!0),a(E,null,L(f.value,l=>(r(),a("div",{key:l.id,class:"bg-white rounded-xl shadow-md p-6"},[t("div",Se,[t("div",Te,[t("div",De,u(l.name.charAt(0)),1),t("div",je,[t("h4",Be,u(l.name),1),t("p",qe,u(l.date),1)])]),t("div",Ue,[(r(),a(E,null,L(5,n=>t("i",{key:n,class:"fas fa-star"})),64))])]),t("p",Ve,u(l.text),1)]))),128))])):(r(),a("div",Re,[...e[24]||(e[24]=[t("i",{class:"fas fa-comments text-gray-400 text-4xl mb-4","aria-hidden":"true"},null,-1),t("p",{class:"text-gray-600"},"هنوز نظری ثبت نشده است. اولین نفر باشید!",-1)])]))])])]),h(t("button",{onClick:J,class:"fixed bottom-6 left-6 w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 text-white flex items-center justify-center shadow-lg transition-all duration-300 hover:shadow-xl hover:scale-110 z-50","aria-label":"بازگشت به بالا"},[...e[26]||(e[26]=[t("i",{class:"fas fa-arrow-up","aria-hidden":"true"},null,-1)])],512),[[W,$.value]])]))}};export{Je as default};
